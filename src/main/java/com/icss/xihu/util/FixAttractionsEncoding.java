package com.icss.xihu.util;

import java.sql.*;

/**
 * 修复attractions表中损坏的中文数据（问号问题）
 * 使用方法：直接运行main方法
 */
public class FixAttractionsEncoding {
    
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/xihu?useUnicode=true&characterEncoding=utf8&characterSetResults=utf8&connectionCollation=utf8mb4_unicode_ci&serverTimezone=Asia/Shanghai";
        String user = "root";
        String password = "123456";
        
        try (Connection conn = DriverManager.getConnection(url, user, password)) {
            conn.setAutoCommit(false);
            
            // 设置连接字符集
            try (Statement stmt = conn.createStatement()) {
                stmt.execute("SET NAMES utf8mb4");
                stmt.execute("SET CHARACTER SET utf8mb4");
            }
            
            // 定义所有需要修复的数据
            String[][] fixes = {
                {"45", "天坛公园", "北京市", "11", "北京市", "1101"},
                {"46", "颐和园", "北京市", "11", "北京市", "1101"},
                {"47", "圆明园", "北京市", "11", "北京市", "1101"},
                {"48", "古文化街", "天津市", "12", "天津市", "1201"},
                {"49", "天津之眼", "天津市", "12", "天津市", "1201"},
                {"50", "承德避暑山庄", "河北省", "13", "承德市", "1308"},
                {"51", "山海关", "河北省", "13", "秦皇岛市", "1303"},
                {"52", "平遥古城", "山西省", "14", "晋中市", "1407"},
                {"53", "云冈石窟", "山西省", "14", "大同市", "1402"},
                {"54", "呼伦贝尔大草原", "内蒙古自治区", "15", "呼伦贝尔市", "1507"},
                {"55", "响沙湾", "内蒙古自治区", "15", "鄂尔多斯市", "1506"},
                {"56", "沈阳故宫", "辽宁省", "21", "沈阳市", "2101"},
                {"57", "大连星海广场", "辽宁省", "21", "大连市", "2102"},
                {"58", "长白山天池", "吉林省", "22", "白山市", "2206"},
                {"59", "伪满皇宫博物院", "吉林省", "22", "长春市", "2201"},
                {"60", "哈尔滨冰雪大世界", "黑龙江省", "23", "哈尔滨市", "2301"},
                {"61", "中央大街", "黑龙江省", "23", "哈尔滨市", "2301"},
                {"62", "外滩", "上海市", "31", "上海市", "3101"},
                {"63", "东方明珠", "上海市", "31", "上海市", "3101"},
                {"64", "豫园", "上海市", "31", "上海市", "3101"},
                {"65", "苏州园林", "江苏省", "32", "苏州市", "3205"},
                {"66", "中山陵", "江苏省", "32", "南京市", "3201"},
                {"67", "西湖", "浙江省", "33", "杭州市", "3301"},
                {"68", "乌镇", "浙江省", "33", "嘉兴市", "3304"},
                {"69", "黄山", "安徽省", "34", "黄山市", "3410"},
                {"70", "宏村", "安徽省", "34", "黄山市", "3410"},
                {"71", "鼓浪屿", "福建省", "35", "厦门市", "3502"},
                {"72", "武夷山", "福建省", "35", "南平市", "3507"},
                {"73", "庐山", "江西省", "36", "九江市", "3604"},
                {"74", "滕王阁", "江西省", "36", "南昌市", "3601"},
                {"75", "三清山", "江西省", "36", "上饶市", "3611"},
                {"76", "泰山", "山东省", "37", "泰安市", "3709"},
                {"77", "曲阜三孔", "山东省", "37", "济宁市", "3708"},
                {"78", "龙门石窟", "河南省", "41", "洛阳市", "4103"},
                {"79", "少林寺", "河南省", "41", "郑州市", "4101"},
                {"80", "黄鹤楼", "湖北省", "42", "武汉市", "4201"},
                {"81", "武当山", "湖北省", "42", "十堰市", "4203"},
                {"82", "张家界", "湖南省", "43", "张家界市", "4308"},
                {"83", "凤凰古城", "湖南省", "43", "湘西土家族苗族自治州", "4331"},
                {"84", "广州塔", "广东省", "44", "广州市", "4401"},
                {"85", "长隆欢乐世界", "广东省", "44", "广州市", "4401"},
                {"86", "洪崖洞", "重庆市", "50", "重庆市", "5001"},
                {"87", "大足石刻", "重庆市", "50", "重庆市", "5001"},
                {"88", "黄果树瀑布", "贵州省", "52", "安顺市", "5204"},
                {"89", "西江千户苗寨", "贵州省", "52", "黔东南苗族侗族自治州", "5226"},
                {"90", "莫高窟", "甘肃省", "62", "酒泉市", "6209"},
                {"91", "鸣沙山月牙泉", "甘肃省", "62", "酒泉市", "6209"},
                {"92", "青海湖", "青海省", "63", "海南藏族自治州", "6325"},
                {"93", "茶卡盐湖", "青海省", "63", "海西蒙古族藏族自治州", "6328"},
                {"94", "沙坡头", "宁夏回族自治区", "64", "中卫市", "6405"},
                {"95", "镇北堡西部影城", "宁夏回族自治区", "64", "银川市", "6401"},
                {"111", "日月潭", "台湾省", "71", "南投县", "7108"},
                {"112", "台北101", "台湾省", "71", "台北市", "7101"},
                {"113", "垦丁国家公园", "台湾省", "71", "屏东县", "7127"},
                {"114", "三亚亚龙湾", "海南省", "91", "三亚市", "9100"},
                {"115", "天涯海角", "海南省", "91", "三亚市", "9100"},
                {"116", "蜈支洲岛", "海南省", "91", "三亚市", "9100"},
                {"117", "维多利亚港", "香港特别行政区", "81", "香港特别行政区", "8100"},
                {"118", "香港迪士尼乐园", "香港特别行政区", "81", "香港特别行政区", "8100"},
                {"119", "太平山顶", "香港特别行政区", "81", "香港特别行政区", "8100"},
                {"120", "大三巴牌坊", "澳门特别行政区", "82", "澳门特别行政区", "8200"},
                {"121", "威尼斯人度假村", "澳门特别行政区", "82", "澳门特别行政区", "8200"},
                {"122", "澳门塔", "澳门特别行政区", "82", "澳门特别行政区", "8200"},
                {"126", "滕王阁", "江西省", "1", "南昌市", "2"},
                {"127", "庐山", "江西省", "1", "九江市", "3"},
                {"128", "三清山", "江西省", "1", "上饶市", "2"}
            };
            
            String updateSql = "UPDATE attractions SET name = ?, province = ?, city = ? WHERE id = ?";
            int successCount = 0;
            
            try (PreparedStatement pstmt = conn.prepareStatement(updateSql)) {
                for (String[] fix : fixes) {
                    String id = fix[0];
                    String name = fix[1];
                    String province = fix[2];
                    String city = fix[4];
                    
                    pstmt.setString(1, name);
                    pstmt.setString(2, province);
                    pstmt.setString(3, city);
                    pstmt.setInt(4, Integer.parseInt(id));
                    
                    int rows = pstmt.executeUpdate();
                    if (rows > 0) {
                        successCount++;
                        System.out.println("修复成功: ID=" + id + ", Name=" + name);
                    }
                }
            }
            
            conn.commit();
            System.out.println("\n总共修复了 " + successCount + " 条记录");
            
            // 验证修复结果
            try (Statement stmt = conn.createStatement()) {
                ResultSet rs = stmt.executeQuery("SELECT COUNT(*) as corrupted FROM attractions WHERE name LIKE '%?%' OR HEX(name) LIKE '%3F%'");
                if (rs.next()) {
                    int corrupted = rs.getInt("corrupted");
                    System.out.println("剩余损坏记录数: " + corrupted);
                }
            }
            
        } catch (SQLException e) {
            System.err.println("修复失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
}

