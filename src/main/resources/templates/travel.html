<!--
    æ–‡ä»¶åç§°ï¼štravel.html
    æ–‡ä»¶åŠŸèƒ½ï¼šæ™¯ç‚¹æ¨èé¡µé¢æ¨¡æ¿
    åŠŸèƒ½æ¦‚è¿°ï¼š
        1. æ˜¾ç¤ºæ™¯ç‚¹æ¨èé¡µé¢ï¼ŒåŒ…æ‹¬ç­›é€‰åŒºåŸŸï¼ˆçœä»½ã€åŸå¸‚ã€åˆ†ç±»ã€æœç´¢ï¼‰
        2. æä¾›æ™¯ç‚¹åˆ—è¡¨å±•ç¤ºï¼ˆæ™¯ç‚¹å¡ç‰‡ï¼ŒåŒ…å«å›¾ç‰‡ã€åç§°ã€ä½ç½®ã€è¯„åˆ†ã€ä»·æ ¼ã€æè¿°ã€æ ‡ç­¾ã€ç»Ÿè®¡ç­‰ï¼‰
        3. æä¾›æ”¶è—åŠŸèƒ½ï¼ˆæ·»åŠ /å–æ¶ˆæ”¶è—æ™¯ç‚¹ï¼‰
        4. æä¾›æµè§ˆå†å²è®°å½•åŠŸèƒ½ï¼ˆè®°å½•ç”¨æˆ·æµè§ˆçš„æ™¯ç‚¹ï¼‰
        5. æä¾›æœç´¢å†å²è®°å½•åŠŸèƒ½ï¼ˆè®°å½•ç”¨æˆ·æœç´¢çš„å…³é”®è¯ï¼‰
        6. æä¾›localStorageç¼“å­˜åŠŸèƒ½ï¼ˆç¼“å­˜çœä»½ã€åŸå¸‚ã€æ™¯ç‚¹æ•°æ®ï¼‰
        7. æä¾›ç”¨æˆ·åå¥½è®¾ç½®åŠŸèƒ½ï¼ˆä¿å­˜ç”¨æˆ·çš„ç­›é€‰åå¥½ï¼‰
        8. å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒPCç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
    æŠ€æœ¯æ ˆï¼šHTML5 + CSS3 + JavaScript + Thymeleafæ¨¡æ¿å¼•æ“
    ä¾èµ–æ–‡ä»¶ï¼š
        - Font Awesomeå›¾æ ‡åº“ï¼ˆCDNï¼‰
        - /css/navbar.cssï¼ˆå¯¼èˆªæ æ ·å¼ï¼‰
        - /css/module-themes.cssï¼ˆæ¨¡å—ä¸»é¢˜æ ·å¼ï¼‰
    ä½œè€…ï¼šæ¸¸å¸‚ç”Ÿæ´»å¼€å‘å›¢é˜Ÿ
    åˆ›å»ºæ—¥æœŸï¼š2024å¹´
    æœ€åæ›´æ–°ï¼š2024å¹´
-->
<!DOCTYPE html>
<!-- HTML5æ–‡æ¡£ç±»å‹å£°æ˜ï¼Œæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªHTML5æ–‡æ¡£ -->
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<!-- 
    HTMLæ ¹å…ƒç´ 
    lang="zh-CN"ï¼šè®¾ç½®é¡µé¢è¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡
    xmlns:th="http://www.thymeleaf.org"ï¼šå£°æ˜Thymeleafå‘½åç©ºé—´ï¼Œç”¨äºæ¨¡æ¿å¼•æ“è¯­æ³•
-->
<head>
    <!-- HTMLæ–‡æ¡£å¤´éƒ¨ï¼ŒåŒ…å«å…ƒæ•°æ®å’Œæ ·å¼è¡¨å¼•ç”¨ -->
    <!-- å­—ç¬¦ç¼–ç å£°æ˜ï¼ŒæŒ‡å®šé¡µé¢ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒä¸­æ–‡ç­‰å¤šè¯­è¨€å­—ç¬¦ -->
    <meta charset="UTF-8">
    <!-- è§†å£å…ƒæ•°æ®ï¼Œè®¾ç½®é¡µé¢åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤ºæ–¹å¼ï¼Œwidth=device-widthè¡¨ç¤ºå®½åº¦è‡ªé€‚åº”è®¾å¤‡å®½åº¦ï¼Œinitial-scale=1.0è¡¨ç¤ºåˆå§‹ç¼©æ”¾æ¯”ä¾‹ä¸º1.0 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <title>æ™¯ç‚¹æ¨è - æ¸¸å¸‚ç”Ÿæ´»</title>
    <!-- Font Awesomeå›¾æ ‡åº“ï¼ˆCDNï¼‰ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- å¯¼èˆªæ æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="/css/navbar.css">
    <!-- æ¨¡å—ä¸»é¢˜æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="/css/module-themes.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* æ—…æ¸¸æœåŠ¡æ¨¡å—ä¸ªæ€§åŒ–æ ·å¼ */
        .module-travel {
            --primary-color: #667eea;
            --primary-light: #764ba2;
            --primary-dark: #5a6fd8;
            --accent-color: #a8b5ff;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            --hover-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #667eea;
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #667eea;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            padding-top: 110px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header-section h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header-section p {
            font-size: 20px;
            opacity: 0.9;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .filter-group label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .filter-select, .search-input {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-group {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        .search-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }


        .attractions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .attraction-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .attraction-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .card-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            position: relative;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .attraction-card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .rating-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 193, 7, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-content {
            padding: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .card-location {
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-price {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .card-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tag {
            background: #f8f9fa;
            color: #495057;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #e9ecef;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .card-stats {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 14px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .view-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .loading, .no-results {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 18px;
        }

        .loading i {
            font-size: 48px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
                gap: 15px;
            }

            .filter-group, .search-group {
                width: 100%;
            }

            .attractions-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header-section h1 {
                font-size: 36px;
            }
            
        }

        /* æ”¶è—æŒ‰é’®æ ·å¼ */
        .favorite-btn {
            position: absolute;
            top: 15px;
            right: 50px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .favorite-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .favorite-btn.favorited {
            background: rgba(220, 53, 69, 0.9);
            color: white;
        }

        .favorite-btn.favorited:hover {
            background: rgba(220, 53, 69, 1);
        }

        /* ä¼˜åŒ–å¡ç‰‡æ ·å¼ä»¥é€‚åº”æ”¶è—æŒ‰é’® */
        .card-image {
            position: relative;
        }

        .rating-badge {
            right: 15px;
            top: 60px;
        }
    </style>
</head>
<body>
    <!-- é¡µé¢ä¸»ä½“ -->
    <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
    <!-- é¡µé¢å¤´éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <!-- å¯¼èˆªæ å®¹å™¨ -->
        <nav class="nav">
            <!-- ç½‘ç«™Logoé“¾æ¥ -->
            <a href="/" class="logo">
                <!-- åŸå¸‚å›¾æ ‡ -->
                <i class="fas fa-city"></i>
                <!-- ç½‘ç«™åç§° -->
                æ¸¸å¸‚ç”Ÿæ´»
            </a>
            <!-- å¯¼èˆªé“¾æ¥åˆ—è¡¨ -->
            <ul class="nav-links">
                <!-- é¦–é¡µå¯¼èˆªé“¾æ¥ -->
                <li><a href="/">é¦–é¡µ</a></li>
                <!-- ä½å®¿æœåŠ¡å¯¼èˆªé“¾æ¥ -->
                <li><a href="/hc/f2">ä½å®¿æœåŠ¡</a></li>
                <!-- å‡ºè¡ŒæœåŠ¡å¯¼èˆªé“¾æ¥ -->
                <li><a href="/travel">å‡ºè¡ŒæœåŠ¡</a></li>
                <!-- ç¾é£ŸæœåŠ¡å¯¼èˆªé“¾æ¥ -->
                <li><a href="/food">ç¾é£ŸæœåŠ¡</a></li>
                <!-- è´­ç‰©æœåŠ¡å¯¼èˆªé“¾æ¥ -->
                <li><a href="/shopping">è´­ç‰©æœåŠ¡</a></li>
                <!-- ç”Ÿæ´»ç¼´è´¹å¯¼èˆªé“¾æ¥ -->
                <li><a href="/payment">ç”Ÿæ´»ç¼´è´¹</a></li>
            </ul>
            <!-- ç”¨æˆ·æ“ä½œåŒºåŸŸ -->
            <div class="user-actions">
                <!-- æœªç™»å½•çŠ¶æ€æ˜¾ç¤º -->
                <!-- ä½¿ç”¨Thymeleafåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœªç™»å½• -->
                <div th:if="${session.user == null}">
                    <!-- ç™»å½•æŒ‰é’®é“¾æ¥ -->
                    <a href="/user/login" class="login-btn">ç™»å½•</a>
                    <!-- æ³¨å†ŒæŒ‰é’®é“¾æ¥ -->
                    <a href="/user/register" class="register-btn">æ³¨å†Œ</a>
                </div>
                <!-- å·²ç™»å½•çŠ¶æ€æ˜¾ç¤º -->
                <!-- ä½¿ç”¨Thymeleafåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç™»å½• -->
                <div th:if="${session.user != null}">
                    <!-- æˆ‘çš„è®¢å•é“¾æ¥ï¼ˆç»Ÿä¸€è®¢å•ä¸­å¿ƒï¼‰ -->
                    <a href="/unified-new/orders" style="color: #FF6600; text-decoration: none; font-weight: 500; margin-right: 15px;">
                        <!-- è®¢å•åˆ—è¡¨å›¾æ ‡ -->
                        <i class="fas fa-list-alt"></i>
                        <!-- æˆ‘çš„è®¢å•æ–‡æœ¬ -->
                        æˆ‘çš„è®¢å•
                    </a>
                    <!-- ä¸ªäººä¸­å¿ƒé“¾æ¥ -->
                    <a href="/user/profile" style="color: #FF6600; text-decoration: none; font-weight: 500;">
                        <!-- ç”¨æˆ·å›¾æ ‡ -->
                        <i class="fas fa-user-circle"></i>
                        <!-- ç”¨æˆ·æ˜µç§°æˆ–ç”¨æˆ·åï¼ˆä½¿ç”¨ThymeleafåŠ¨æ€æ˜¾ç¤ºï¼Œä¼˜å…ˆæ˜¾ç¤ºæ˜µç§°ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºç”¨æˆ·åï¼‰ -->
                        <span th:text="${session.user.nickname ?: session.user.username}">ç”¨æˆ·</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <!-- æ™¯ç‚¹æ¨èé¡µé¢ä¸»è¦å†…å®¹åŒºåŸŸï¼ˆä½¿ç”¨module-travelç±»åº”ç”¨å‡ºè¡Œæ¨¡å—ä¸ªæ€§åŒ–æ ·å¼ï¼‰ -->
    <div class="main-container module-travel">
        <!-- å¤´éƒ¨æ ‡é¢˜ -->
        <!-- é¡µé¢å¤´éƒ¨æ ‡é¢˜åŒºåŸŸ -->
        <div class="header-section">
            <!-- é¡µé¢ä¸»æ ‡é¢˜ï¼ˆå¸¦å›¾æ ‡ï¼‰ -->
            <h1><i class="fas fa-map-pin"></i> æ™¯ç‚¹æ¨è</h1>
            <!-- é¡µé¢å‰¯æ ‡é¢˜ -->
            <p>æ¢ç´¢ç²¾é€‰æ™¯ç‚¹ï¼Œå‘ç°ç¾å¥½æ—…ç¨‹</p>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <!-- æ™¯ç‚¹ç­›é€‰åŒºåŸŸ -->
        <div class="filter-section">
            <!-- ç­›é€‰è¡Œå®¹å™¨ -->
            <div class="filter-row">
                <!-- çœä»½ç­›é€‰ç»„ -->
                <div class="filter-group">
                    <!-- çœä»½ç­›é€‰æ ‡ç­¾ -->
                    <label for="provinceSelect">é€‰æ‹©çœä»½</label>
                    <!-- çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ˆé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½çœä»½é€‰é¡¹ï¼‰ -->
                    <select id="provinceSelect" class="filter-select">
                        <!-- é»˜è®¤é€‰é¡¹ -->
                        <option value="">æ‰€æœ‰çœä»½</option>
                    </select>
                </div>
                <!-- åŸå¸‚ç­›é€‰ç»„ -->
                <div class="filter-group">
                    <!-- åŸå¸‚ç­›é€‰æ ‡ç­¾ -->
                    <label for="citySelect">é€‰æ‹©åŸå¸‚</label>
                    <!-- åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ˆåˆå§‹ç¦ç”¨ï¼Œé€‰æ‹©çœä»½åå¯ç”¨ï¼Œé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½åŸå¸‚é€‰é¡¹ï¼‰ -->
                    <select id="citySelect" class="filter-select" disabled>
                        <!-- é»˜è®¤é€‰é¡¹ -->
                        <option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>
                    </select>
                </div>
                <!-- æœç´¢ç»„ -->
                <div class="search-group">
                    <!-- æœç´¢è¾“å…¥ç»„ -->
                    <div class="filter-group">
                        <!-- æœç´¢è¾“å…¥æ ‡ç­¾ -->
                        <label for="searchInput">æœç´¢æ™¯ç‚¹</label>
                        <!-- æœç´¢è¾“å…¥æ¡†ï¼ˆæ–‡æœ¬ç±»å‹ï¼Œå ä½ç¬¦æç¤ºç”¨æˆ·è¾“å…¥æ™¯ç‚¹åç§°ï¼‰ -->
                        <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥æ™¯ç‚¹åç§°...">
                    </div>
                    <!-- æœç´¢æŒ‰é’®ï¼ˆç‚¹å‡»åè°ƒç”¨searchAttractionså‡½æ•°ï¼‰ -->
                    <button class="search-btn" onclick="searchAttractions()">
                        <!-- æœç´¢å›¾æ ‡ -->
                        <i class="fas fa-search"></i> 
                        <!-- æœç´¢æ–‡æœ¬ -->
                        æœç´¢
                    </button>
                </div>
            </div>

            <!-- åˆ†ç±»ç­›é€‰ -->
        </div>

        <!-- æ™¯ç‚¹åˆ—è¡¨ -->
        <!-- æ™¯ç‚¹åˆ—è¡¨å®¹å™¨ï¼ˆé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½æ™¯ç‚¹æ•°æ®ï¼‰ -->
        <div id="attractionsContainer">
            <!-- åŠ è½½çŠ¶æ€æç¤ºï¼ˆåˆå§‹æ˜¾ç¤ºï¼Œé€šè¿‡JavaScriptæ§åˆ¶æ˜¾ç¤º/éšè—ï¼‰ -->
            <div class="loading">
                <!-- åŠ è½½åŠ¨ç”»å›¾æ ‡ï¼ˆæ—‹è½¬åŠ¨ç”»ï¼‰ -->
                <i class="fas fa-spinner"></i>
                <!-- åŠ è½½æç¤ºæ–‡æœ¬ -->
                <div>æ­£åœ¨åŠ è½½æ™¯ç‚¹ä¿¡æ¯...</div>
            </div>
        </div>
    </div>

    <!-- 
        JavaScriptä»£ç å—
        åŠŸèƒ½æ¦‚è¿°ï¼šå®ç°æ™¯ç‚¹æ¨èé¡µé¢çš„äº¤äº’åŠŸèƒ½ï¼ŒåŒ…æ‹¬localStorageæ•°æ®ç®¡ç†ã€æ™¯ç‚¹æ•°æ®åŠ è½½ã€ç­›é€‰ã€æœç´¢ã€æ”¶è—ã€æµè§ˆå†å²ç­‰
    -->
    <script>
        /**
         * æ–‡ä»¶çº§æ³¨é‡Šï¼šæ™¯ç‚¹æ¨èé¡µé¢JavaScriptåŠŸèƒ½æ¨¡å—
         * åŠŸèƒ½æ¦‚è¿°ï¼š
         *   1. localStorageæ•°æ®ç®¡ç†åŠŸèƒ½ï¼ˆUserDataManagerç±»ï¼šç”¨æˆ·åå¥½ã€æµè§ˆå†å²ã€æœç´¢å†å²ã€æ”¶è—ã€ç¼“å­˜ç­‰ï¼‰
         *   2. æ™¯ç‚¹æ•°æ®åŠ è½½åŠŸèƒ½ï¼ˆæ ¹æ®çœä»½ã€åŸå¸‚ã€åˆ†ç±»åŠ è½½æ™¯ç‚¹æ•°æ®ï¼Œæ”¯æŒç¼“å­˜ï¼‰
         *   3. ç­›é€‰åŠŸèƒ½ï¼ˆçœä»½ã€åŸå¸‚ã€åˆ†ç±»ç­›é€‰ï¼‰
         *   4. æœç´¢åŠŸèƒ½ï¼ˆæœç´¢æ™¯ç‚¹åç§°ï¼Œæ”¯æŒæœç´¢å†å²ï¼‰
         *   5. æ”¶è—åŠŸèƒ½ï¼ˆæ·»åŠ /å–æ¶ˆæ”¶è—æ™¯ç‚¹ï¼‰
         *   6. æµè§ˆå†å²åŠŸèƒ½ï¼ˆè®°å½•ç”¨æˆ·æµè§ˆçš„æ™¯ç‚¹ï¼‰
         *   7. æ™¯ç‚¹å¡ç‰‡å±•ç¤ºåŠŸèƒ½ï¼ˆåˆ›å»ºå’Œæ˜¾ç¤ºæ™¯ç‚¹å¡ç‰‡ï¼‰
         *   8. å¯¼èˆªæ¿€æ´»çŠ¶æ€è®¾ç½®åŠŸèƒ½ï¼ˆæ ¹æ®å½“å‰è·¯å¾„è®¾ç½®å¯¼èˆªé“¾æ¥çš„æ¿€æ´»çŠ¶æ€ï¼‰
         *   9. é¡µé¢åˆå§‹åŒ–åŠŸèƒ½ï¼ˆç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼ŒåŠ è½½åˆå§‹æ•°æ®ï¼‰
         */
        
        // ==================== é»˜è®¤å›¾ç‰‡æ•°æ®æ¨¡å— ====================
        /**
         * é»˜è®¤æ™¯ç‚¹å›¾ç‰‡URLæ•°ç»„
         * åŠŸèƒ½æ¦‚è¿°ï¼šæä¾›43å¼ ç¾ä¸½æ™¯ç‚¹å›¾ç‰‡URLï¼Œç”¨äºæ™¯ç‚¹å¡ç‰‡é»˜è®¤å›¾ç‰‡æ˜¾ç¤º
         */
        // ===== 43å¼ ç¾ä¸½æ™¯ç‚¹å›¾ç‰‡URLæ•°ç»„ =====
        // åˆå§‹åŒ–é»˜è®¤æ™¯ç‚¹å›¾ç‰‡URLæ•°ç»„ï¼ˆåŒ…å«43å¼ ä¸åŒç±»åˆ«çš„æ™¯ç‚¹å›¾ç‰‡ï¼‰
        const defaultAttractionImages = [
            // è‡ªç„¶é£å…‰ç±»
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å±±å³°
            'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ£®æ—
            'https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ¹–æ³Š
            'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·å²¸
            'https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç€‘å¸ƒ
            'https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // é›ªå±±
            'https://images.unsplash.com/photo-1501436513145-30f24e19fcc4?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ²™æ¼ 
            'https://images.unsplash.com/photo-1464822759844-d150f84ad8de?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å³¡è°·
            'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·æ»©
            'https://images.unsplash.com/photo-1439066615861-d1af74d74000?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ—¥å‡º
            
            // å¤å»ºç­‘æ–‡åŒ–ç±»
            'https://images.unsplash.com/photo-1508804185872-d7badad00f7d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤å¯ºåº™
            'https://images.unsplash.com/photo-1471919743851-c4df8b6ee133?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤åŸå¢™
            'https://images.unsplash.com/photo-1545558014-8692077e9b5c?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å®«æ®¿
            'https://images.unsplash.com/photo-1513415825881-57c6b43bf862?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤å¡”
            'https://images.unsplash.com/photo-1559717201-fbb671ff56b7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ä¼ ç»Ÿå»ºç­‘
            'https://images.unsplash.com/photo-1518709268805-4e9042af2ac0?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ¡¥
            'https://images.unsplash.com/photo-1574608851747-15d28b7e3d69?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å›­æ—
            'https://images.unsplash.com/photo-1565967511849-76a60a516170?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // äº­å°æ¥¼é˜
            'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ‘è½
            'https://images.unsplash.com/photo-1609948668013-b5e7f3088607?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ•…å®«
            
            // ç°ä»£æ™¯è§‚ç±»
            'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç°ä»£å»ºç­‘
            'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1f?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ‘©å¤©å¤§æ¥¼
            'https://images.unsplash.com/photo-1514924013411-cbf25faa35bb?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // åŸå¸‚å¤œæ™¯
            'https://images.unsplash.com/photo-1549924231-f129b911e442?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å…¬å›­
            'https://images.unsplash.com/photo-1533587851505-d119e13fa0d7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¹¿åœº
            'https://images.unsplash.com/photo-1529655683826-3c6b7ded86b6?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // åšç‰©é¦†
            'https://images.unsplash.com/photo-1429734956993-8a9b0555e122?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // è‰ºæœ¯é¦†
            'https://images.unsplash.com/photo-1494949649109-ecfc3b8c35df?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç§‘æŠ€é¦†
            'https://images.unsplash.com/photo-1518135714426-c18f5ffb6f4d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // è§‚æ™¯å°
            'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ä¸»é¢˜å…¬å›­
            
            // ç‰¹è‰²æ™¯ç‚¹ç±»
            'https://images.unsplash.com/photo-1464278533981-50106e6176b1?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç«¹æ—
            'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // èŒ¶å›­
            'https://images.unsplash.com/photo-1548013146-72479768bada?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // èŠ±ç”°
            'https://images.unsplash.com/photo-1490730141103-6cac27aaab94?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç”°å›­é£å…‰
            'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤é•‡
            'https://images.unsplash.com/photo-1586511925558-a4c6376fe65f?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ±Ÿå—æ°´ä¹¡
            'https://images.unsplash.com/photo-1571804499305-1dfe4c7e5d63?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ°‘ä¿—æ‘
            'https://images.unsplash.com/photo-1555400113-8a2d1c19f1e1?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ¸©æ³‰
            'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·å²›
            'https://images.unsplash.com/photo-1537225228614-56cc3556d7ed?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æº¶æ´
            
            // å­£èŠ‚ç‰¹è‰²ç±»
            'https://images.unsplash.com/photo-1509773896068-7fd415d91e2e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ˜¥èŠ±
            'https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ—¥æµ·æ»¨
            'https://images.unsplash.com/photo-1507608869274-d3177c8bb4c7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç§‹å¶
            'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&w=800&h=600&fit=crop'  // å†¬é›ª
        ];

        /**
         * è·å–éšæœºé»˜è®¤å›¾ç‰‡
         * åŠŸèƒ½æ¦‚è¿°ï¼šä»é»˜è®¤æ™¯ç‚¹å›¾ç‰‡æ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸€å¼ å›¾ç‰‡URL
         * @returns {String} éšæœºå›¾ç‰‡URL
         */
        function getRandomDefaultImage() {
            // ç”Ÿæˆéšæœºç´¢å¼•ï¼ˆ0åˆ°æ•°ç»„é•¿åº¦-1ä¹‹é—´çš„éšæœºæ•´æ•°ï¼‰
            const randomIndex = Math.floor(Math.random() * defaultAttractionImages.length);
            // è¿”å›éšæœºç´¢å¼•å¯¹åº”çš„å›¾ç‰‡URL
            return defaultAttractionImages[randomIndex];
        }

        // ==================== localStorageæ•°æ®ç®¡ç†åŠŸèƒ½æ¨¡å— ====================
        /**
         * UserDataManagerç±»
         * åŠŸèƒ½æ¦‚è¿°ï¼šç®¡ç†ç”¨æˆ·æ•°æ®çš„localStorageå­˜å‚¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¥½ã€æµè§ˆå†å²ã€æœç´¢å†å²ã€æ”¶è—ã€ç¼“å­˜ç­‰
         */
        // ===== localStorage æ•°æ®ç®¡ç†ç³»ç»Ÿ =====
        // å®šä¹‰UserDataManagerç±»ï¼Œç”¨äºç®¡ç†ç”¨æˆ·æ•°æ®çš„localStorageå­˜å‚¨
        class UserDataManager {
            /**
             * æ„é€ å‡½æ•°
             * åŠŸèƒ½æ¦‚è¿°ï¼šåˆå§‹åŒ–UserDataManagerç±»ï¼Œè®¾ç½®localStorageé”®åå’Œç¼“å­˜è¿‡æœŸæ—¶é—´
             */
            constructor() {
                // å®šä¹‰localStorageé”®åå¯¹è±¡ï¼ˆç”¨äºå­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼‰
                this.storageKeys = {
                    userPreferences: 'xihu_user_preferences',  // ç”¨æˆ·åå¥½è®¾ç½®é”®å
                    browsingHistory: 'xihu_browsing_history',  // æµè§ˆå†å²é”®å
                    searchHistory: 'xihu_search_history',  // æœç´¢å†å²é”®å
                    provincesCache: 'xihu_provinces_cache',  // çœä»½ç¼“å­˜é”®å
                    citiesCache: 'xihu_cities_cache',  // åŸå¸‚ç¼“å­˜é”®å
                    attractionsCache: 'xihu_attractions_cache',  // æ™¯ç‚¹ç¼“å­˜é”®å
                    userProfile: 'xihu_user_profile',  // ç”¨æˆ·èµ„æ–™é”®å
                    favoriteAttractions: 'xihu_favorite_attractions'  // æ”¶è—æ™¯ç‚¹é”®å
                };
                // å®šä¹‰ç¼“å­˜è¿‡æœŸæ—¶é—´å¯¹è±¡ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
                this.cacheExpiry = {
                    provinces: 7 * 24 * 60 * 60 * 1000,  // çœä»½ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š7å¤©
                    cities: 7 * 24 * 60 * 60 * 1000,  // åŸå¸‚ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š7å¤©
                    attractions: 2 * 60 * 60 * 1000,  // æ™¯ç‚¹ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š2å°æ—¶
                    searchHistory: 30 * 24 * 60 * 60 * 1000  // æœç´¢å†å²è¿‡æœŸæ—¶é—´ï¼š30å¤©
                };
            }

            /**
             * ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®
             * åŠŸèƒ½æ¦‚è¿°ï¼šå°†ç”¨æˆ·çš„ç­›é€‰åå¥½ï¼ˆçœä»½ã€åŸå¸‚ã€åˆ†ç±»ï¼‰ä¿å­˜åˆ°localStorage
             * @param {String} province - çœä»½åç§°
             * @param {String} city - åŸå¸‚åç§°
             * @param {String} category - åˆ†ç±»ID
             */
            saveUserPreferences(province, city, category) {
                // æ„å»ºç”¨æˆ·åå¥½å¯¹è±¡
                const preferences = {
                    province: province || '',  // çœä»½åç§°ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
                    city: city || '',  // åŸå¸‚åç§°ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
                    category: category || '',  // åˆ†ç±»IDï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
                    lastUpdated: Date.now(),  // æœ€åæ›´æ–°æ—¶é—´ï¼ˆå½“å‰æ—¶é—´æˆ³ï¼‰
                    visitCount: this.getUserPreferences().visitCount + 1 || 1  // è®¿é—®æ¬¡æ•°ï¼ˆè·å–å½“å‰è®¿é—®æ¬¡æ•°åŠ 1ï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸º1ï¼‰
                };
                // å°†ç”¨æˆ·åå¥½å¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²å¹¶ä¿å­˜åˆ°localStorage
                localStorage.setItem(this.storageKeys.userPreferences, JSON.stringify(preferences));
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('âœ… ç”¨æˆ·åå¥½å·²ä¿å­˜:', preferences);
            }

            /**
             * è·å–ç”¨æˆ·åå¥½è®¾ç½®
             * åŠŸèƒ½æ¦‚è¿°ï¼šä»localStorageè·å–ç”¨æˆ·çš„ç­›é€‰åå¥½
             * @returns {Object} ç”¨æˆ·åå¥½å¯¹è±¡ï¼ˆåŒ…å«provinceã€cityã€categoryã€visitCountç­‰å±æ€§ï¼‰
             */
            getUserPreferences() {
                try {
                    // ä»localStorageè·å–ç”¨æˆ·åå¥½æ•°æ®
                    const data = localStorage.getItem(this.storageKeys.userPreferences);
                    // åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
                    // å¦‚æœå­˜åœ¨ï¼Œå°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡å¹¶è¿”å›
                    // å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼å¯¹è±¡
                    return data ? JSON.parse(data) : { province: '', city: '', category: '', visitCount: 0 };
                } catch (error) {
                    // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ˆå¦‚JSONè§£æå¤±è´¥ï¼‰ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                    console.error('âŒ è·å–ç”¨æˆ·åå¥½å¤±è´¥:', error);
                    // è¿”å›é»˜è®¤å€¼å¯¹è±¡
                    return { province: '', city: '', category: '', visitCount: 0 };
                }
            }

            // ä¿å­˜æµè§ˆå†å²
            saveBrowsingHistory(attractionName, attractionData) {
                try {
                    let history = this.getBrowsingHistory();
                    
                    // ç§»é™¤å·²å­˜åœ¨çš„ç›¸åŒæ™¯ç‚¹ï¼ˆé¿å…é‡å¤ï¼‰
                    history = history.filter(item => item.name !== attractionName);
                    
                    // æ·»åŠ æ–°çš„æµè§ˆè®°å½•
                    const historyItem = {
                        name: attractionName,
                        data: attractionData,
                        timestamp: Date.now(),
                        date: new Date().toLocaleDateString('zh-CN')
                    };
                    
                    history.unshift(historyItem);
                    
                    // åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
                    if (history.length > 50) {
                        history = history.slice(0, 50);
                    }
                    
                    localStorage.setItem(this.storageKeys.browsingHistory, JSON.stringify(history));
                    console.log('âœ… æµè§ˆå†å²å·²ä¿å­˜:', attractionName);
                } catch (error) {
                    console.error('âŒ ä¿å­˜æµè§ˆå†å²å¤±è´¥:', error);
                }
            }

            // è·å–æµè§ˆå†å²
            getBrowsingHistory() {
                try {
                    const data = localStorage.getItem(this.storageKeys.browsingHistory);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('âŒ è·å–æµè§ˆå†å²å¤±è´¥:', error);
                    return [];
                }
            }

            // ä¿å­˜æœç´¢å†å²
            saveSearchHistory(keyword) {
                if (!keyword || keyword.trim().length < 2) return;
                
                try {
                    let searches = this.getSearchHistory();
                    
                    // ç§»é™¤å·²å­˜åœ¨çš„ç›¸åŒæœç´¢è¯
                    searches = searches.filter(item => item.keyword !== keyword);
                    
                    // æ·»åŠ æ–°çš„æœç´¢è®°å½•
                    searches.unshift({
                        keyword: keyword,
                        timestamp: Date.now(),
                        date: new Date().toLocaleDateString('zh-CN')
                    });
                    
                    // åªä¿ç•™æœ€è¿‘20æ¡æœç´¢è®°å½•
                    if (searches.length > 20) {
                        searches = searches.slice(0, 20);
                    }
                    
                    localStorage.setItem(this.storageKeys.searchHistory, JSON.stringify(searches));
                    console.log('âœ… æœç´¢å†å²å·²ä¿å­˜:', keyword);
                } catch (error) {
                    console.error('âŒ ä¿å­˜æœç´¢å†å²å¤±è´¥:', error);
                }
            }

            // è·å–æœç´¢å†å²
            getSearchHistory() {
                try {
                    const data = localStorage.getItem(this.storageKeys.searchHistory);
                    if (!data) return [];
                    
                    const searches = JSON.parse(data);
                    // æ¸…ç†è¿‡æœŸçš„æœç´¢è®°å½•
                    const validSearches = searches.filter(item => 
                        Date.now() - item.timestamp < this.cacheExpiry.searchHistory
                    );
                    
                    if (validSearches.length !== searches.length) {
                        localStorage.setItem(this.storageKeys.searchHistory, JSON.stringify(validSearches));
                    }
                    
                    return validSearches;
                } catch (error) {
                    console.error('âŒ è·å–æœç´¢å†å²å¤±è´¥:', error);
                    return [];
                }
            }

            // ç¼“å­˜çœä»½æ•°æ®
            cacheProvinces(provinces) {
                const cacheData = {
                    data: provinces,
                    timestamp: Date.now()
                };
                localStorage.setItem(this.storageKeys.provincesCache, JSON.stringify(cacheData));
                console.log('âœ… çœä»½æ•°æ®å·²ç¼“å­˜, æ•°é‡:', provinces.length);
            }

            // è·å–ç¼“å­˜çš„çœä»½æ•°æ®
            getCachedProvinces() {
                try {
                    const data = localStorage.getItem(this.storageKeys.provincesCache);
                    if (!data) return null;
                    
                    const cache = JSON.parse(data);
                    if (Date.now() - cache.timestamp > this.cacheExpiry.provinces) {
                        localStorage.removeItem(this.storageKeys.provincesCache);
                        console.log('â° çœä»½ç¼“å­˜å·²è¿‡æœŸï¼Œå·²æ¸…ç†');
                        return null;
                    }
                    
                    console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„çœä»½æ•°æ®, æ•°é‡:', cache.data.length);
                    return cache.data;
                } catch (error) {
                    console.error('âŒ è·å–çœä»½ç¼“å­˜å¤±è´¥:', error);
                    return null;
                }
            }

            // ç¼“å­˜åŸå¸‚æ•°æ®
            cacheCities(province, cities) {
                try {
                    let allCitiesCache = JSON.parse(localStorage.getItem(this.storageKeys.citiesCache)) || {};
                    
                    allCitiesCache[province] = {
                        data: cities,
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem(this.storageKeys.citiesCache, JSON.stringify(allCitiesCache));
                    console.log(`âœ… ${province} åŸå¸‚æ•°æ®å·²ç¼“å­˜, æ•°é‡:`, cities.length);
                } catch (error) {
                    console.error('âŒ ç¼“å­˜åŸå¸‚æ•°æ®å¤±è´¥:', error);
                }
            }

            // è·å–ç¼“å­˜çš„åŸå¸‚æ•°æ®
            getCachedCities(province) {
                try {
                    const data = localStorage.getItem(this.storageKeys.citiesCache);
                    if (!data) return null;
                    
                    const cache = JSON.parse(data);
                    const provinceCache = cache[province];
                    
                    if (!provinceCache) return null;
                    
                    if (Date.now() - provinceCache.timestamp > this.cacheExpiry.cities) {
                        delete cache[province];
                        localStorage.setItem(this.storageKeys.citiesCache, JSON.stringify(cache));
                        console.log(`â° ${province} åŸå¸‚ç¼“å­˜å·²è¿‡æœŸï¼Œå·²æ¸…ç†`);
                        return null;
                    }
                    
                    console.log(`âœ… ä½¿ç”¨ç¼“å­˜çš„${province}åŸå¸‚æ•°æ®, æ•°é‡:`, provinceCache.data.length);
                    return provinceCache.data;
                } catch (error) {
                    console.error('âŒ è·å–åŸå¸‚ç¼“å­˜å¤±è´¥:', error);
                    return null;
                }
            }

            // ä¿å­˜/æ›´æ–°ç”¨æˆ·æ”¶è—
            toggleFavorite(attractionName, attractionData) {
                try {
                    let favorites = this.getFavorites();
                    const index = favorites.findIndex(item => item.name === attractionName);
                    
                    if (index > -1) {
                        // å–æ¶ˆæ”¶è—
                        favorites.splice(index, 1);
                        console.log('ğŸ’” å·²å–æ¶ˆæ”¶è—:', attractionName);
                        localStorage.setItem(this.storageKeys.favoriteAttractions, JSON.stringify(favorites));
                        return false;
                    } else {
                        // æ·»åŠ æ”¶è—
                        favorites.unshift({
                            name: attractionName,
                            data: attractionData,
                            timestamp: Date.now(),
                            date: new Date().toLocaleDateString('zh-CN')
                        });
                        console.log('â¤ï¸ å·²æ·»åŠ æ”¶è—:', attractionName);
                        localStorage.setItem(this.storageKeys.favoriteAttractions, JSON.stringify(favorites));
                        return true;
                    }
                } catch (error) {
                    console.error('âŒ æ“ä½œæ”¶è—å¤±è´¥:', error);
                    return false;
                }
            }

            // è·å–æ”¶è—åˆ—è¡¨
            getFavorites() {
                try {
                    const data = localStorage.getItem(this.storageKeys.favoriteAttractions);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('âŒ è·å–æ”¶è—åˆ—è¡¨å¤±è´¥:', error);
                    return [];
                }
            }

            // æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
            isFavorite(attractionName) {
                const favorites = this.getFavorites();
                return favorites.some(item => item.name === attractionName);
            }

            // æ¸…ç†è¿‡æœŸç¼“å­˜
            cleanExpiredCache() {
                try {
                    // æ¸…ç†çœä»½ç¼“å­˜
                    const provincesData = localStorage.getItem(this.storageKeys.provincesCache);
                    if (provincesData) {
                        const cache = JSON.parse(provincesData);
                        if (Date.now() - cache.timestamp > this.cacheExpiry.provinces) {
                            localStorage.removeItem(this.storageKeys.provincesCache);
                            console.log('ğŸ§¹ å·²æ¸…ç†è¿‡æœŸçš„çœä»½ç¼“å­˜');
                        }
                    }

                    // æ¸…ç†åŸå¸‚ç¼“å­˜
                    const citiesData = localStorage.getItem(this.storageKeys.citiesCache);
                    if (citiesData) {
                        const cache = JSON.parse(citiesData);
                        let hasChanged = false;
                        
                        Object.keys(cache).forEach(province => {
                            if (Date.now() - cache[province].timestamp > this.cacheExpiry.cities) {
                                delete cache[province];
                                hasChanged = true;
                            }
                        });
                        
                        if (hasChanged) {
                            localStorage.setItem(this.storageKeys.citiesCache, JSON.stringify(cache));
                            console.log('ğŸ§¹ å·²æ¸…ç†è¿‡æœŸçš„åŸå¸‚ç¼“å­˜');
                        }
                    }

                    console.log('âœ… ç¼“å­˜æ¸…ç†å®Œæˆ');
                } catch (error) {
                    console.error('âŒ æ¸…ç†ç¼“å­˜å¤±è´¥:', error);
                }
            }

            // è·å–å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯
            getStorageStats() {
                const stats = {
                    preferences: this.getUserPreferences(),
                    browsingHistoryCount: this.getBrowsingHistory().length,
                    searchHistoryCount: this.getSearchHistory().length,
                    favoritesCount: this.getFavorites().length,
                    hasProvincesCache: !!localStorage.getItem(this.storageKeys.provincesCache),
                    hasCitiesCache: !!localStorage.getItem(this.storageKeys.citiesCache)
                };
                
                console.log('ğŸ“Š å­˜å‚¨ç»Ÿè®¡:', stats);
                return stats;
            }

            // æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
            clearAllUserData() {
                Object.values(this.storageKeys).forEach(key => {
                    localStorage.removeItem(key);
                });
                console.log('ğŸ§¹ æ‰€æœ‰ç”¨æˆ·æ•°æ®å·²æ¸…ç©º');
            }
        }

        // ==================== å…¨å±€å˜é‡å’Œåˆå§‹åŒ–æ¨¡å— ====================
        /**
         * åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
         * åŠŸèƒ½æ¦‚è¿°ï¼šåˆ›å»ºUserDataManagerå®ä¾‹ï¼Œç”¨äºç®¡ç†ç”¨æˆ·æ•°æ®çš„localStorageå­˜å‚¨
         */
        // åˆ›å»ºUserDataManagerå®ä¾‹ï¼Œç”¨äºç®¡ç†ç”¨æˆ·æ•°æ®çš„localStorageå­˜å‚¨
        const userDataManager = new UserDataManager();
        
        // ===== åŸæœ‰å˜é‡å’Œåˆå§‹åŒ–é€»è¾‘ =====
        /**
         * å…¨å±€å˜é‡
         * åŠŸèƒ½æ¦‚è¿°ï¼šå­˜å‚¨å½“å‰é¡µé¢çš„ç­›é€‰çŠ¶æ€å’Œæ™¯ç‚¹æ•°æ®
         */
        // å½“å‰åˆ†ç±»IDï¼ˆåˆå§‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
        // å½“å‰çœä»½åç§°ï¼ˆåˆå§‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
        let currentProvince = '';
        // å½“å‰åŸå¸‚åç§°ï¼ˆåˆå§‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
        let currentCity = '';
        
        // ä¸´æ—¶å­˜å‚¨å½“å‰é¡µé¢æ˜¾ç¤ºçš„æ™¯ç‚¹æ•°æ®ï¼ˆkeyä¸ºå¡ç‰‡IDï¼Œvalueä¸ºæ™¯ç‚¹æ•°æ®å¯¹è±¡ï¼‰
        let currentAttractions = {};

        // ==================== é¡µé¢åˆå§‹åŒ–åŠŸèƒ½æ¨¡å— ====================
        /**
         * é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
         * åŠŸèƒ½æ¦‚è¿°ï¼šç›‘å¬DOMContentLoadedäº‹ä»¶ï¼Œå½“DOMåŠ è½½å®Œæˆåè°ƒç”¨initializePageå‡½æ•°åˆå§‹åŒ–é¡µé¢
         */
        // ç›‘å¬DOMContentLoadedäº‹ä»¶ï¼Œå½“DOMåŠ è½½å®Œæˆåè§¦å‘
        document.addEventListener('DOMContentLoaded', function() {
            // è°ƒç”¨initializePageå‡½æ•°åˆå§‹åŒ–é¡µé¢
            initializePage();
        });

        /**
         * åˆå§‹åŒ–é¡µé¢
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ‰§è¡Œé¡µé¢åˆå§‹åŒ–æ“ä½œï¼ŒåŒ…æ‹¬æ¸…ç†è¿‡æœŸç¼“å­˜ã€æ¢å¤ç”¨æˆ·åå¥½ã€åŠ è½½æ•°æ®ã€è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ç­‰
         */
        function initializePage() {
            // æ¸…ç†è¿‡æœŸç¼“å­˜
            // è°ƒç”¨userDataManagerçš„cleanExpiredCacheæ–¹æ³•ï¼Œæ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®
            userDataManager.cleanExpiredCache();
            
            // æ¢å¤ç”¨æˆ·åå¥½è®¾ç½®
            // è°ƒç”¨restoreUserPreferenceså‡½æ•°ï¼Œä»localStorageæ¢å¤ç”¨æˆ·çš„ç­›é€‰åå¥½
            restoreUserPreferences();
            
            // åŠ è½½çœä»½æ•°æ®
            // è°ƒç”¨loadProvinceså‡½æ•°ï¼ŒåŠ è½½çœä»½åˆ—è¡¨ï¼ˆæ”¯æŒç¼“å­˜ï¼‰
            loadProvinces();
            
            // åŠ è½½æ™¯ç‚¹æ•°æ®
            // è°ƒç”¨loadAttractionså‡½æ•°ï¼Œæ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶åŠ è½½æ™¯ç‚¹æ•°æ®
            loadAttractions();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            // è°ƒç”¨setupEventListenerså‡½æ•°ï¼Œä¸ºç­›é€‰æ§ä»¶ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // æ˜¾ç¤ºå­˜å‚¨ç»Ÿè®¡
            // è°ƒç”¨userDataManagerçš„getStorageStatsæ–¹æ³•ï¼Œè·å–å¹¶æ˜¾ç¤ºå­˜å‚¨ç»Ÿè®¡ä¿¡æ¯
            userDataManager.getStorageStats();

            // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
            console.log('ğŸš€ é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œå·²å¯ç”¨localStorageç¼“å­˜åŠŸèƒ½');
        }

        /**
         * æ¢å¤ç”¨æˆ·åå¥½è®¾ç½®
         * åŠŸèƒ½æ¦‚è¿°ï¼šä»localStorageæ¢å¤ç”¨æˆ·çš„ç­›é€‰åå¥½ï¼Œå¹¶æ›´æ–°é¡µé¢çŠ¶æ€
         */
        function restoreUserPreferences() {
            // ä»userDataManagerè·å–ç”¨æˆ·åå¥½è®¾ç½®
            const preferences = userDataManager.getUserPreferences();
            
            // åˆ¤æ–­æ˜¯å¦æœ‰çœä»½åå¥½
            if (preferences.province) {
                // å¦‚æœæœ‰çœä»½åå¥½ï¼Œè®¾ç½®å½“å‰çœä»½ä¸ºåå¥½å€¼
                currentProvince = preferences.province;
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('ğŸ”„ æ¢å¤çœä»½åå¥½:', currentProvince);
            }
            
            // åˆ¤æ–­æ˜¯å¦æœ‰åŸå¸‚åå¥½
            if (preferences.city) {
                // å¦‚æœæœ‰åŸå¸‚åå¥½ï¼Œè®¾ç½®å½“å‰åŸå¸‚ä¸ºåå¥½å€¼
                currentCity = preferences.city;
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('ğŸ”„ æ¢å¤åŸå¸‚åå¥½:', currentCity);
            }
            
            // åˆ¤æ–­æ˜¯å¦æœ‰åˆ†ç±»åå¥½
            if (preferences.category) {
            }

            // åˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦å¤§äº0
            if (preferences.visitCount > 0) {
                // å¦‚æœè®¿é—®æ¬¡æ•°å¤§äº0ï¼Œæ‰“å°æ¬¢è¿ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('ğŸ‘‹ æ¬¢è¿å›æ¥ï¼è¿™æ˜¯æ‚¨ç¬¬', preferences.visitCount, 'æ¬¡è®¿é—®æ™¯ç‚¹æ¨èé¡µé¢');
            }
        }

        /**
         * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
         * åŠŸèƒ½æ¦‚è¿°ï¼šä¸ºç­›é€‰æ§ä»¶ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬çœä»½é€‰æ‹©ã€åŸå¸‚é€‰æ‹©ã€åˆ†ç±»æŒ‰é’®ã€æœç´¢è¾“å…¥æ¡†ç­‰
         */
        function setupEventListeners() {
            // çœä»½é€‰æ‹©å˜åŒ–
            // ä¸ºçœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†ç»‘å®šchangeäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('provinceSelect').addEventListener('change', function() {
                // è·å–å½“å‰é€‰æ‹©çš„çœä»½å€¼
                const province = this.value;
                // æ›´æ–°å½“å‰çœä»½å˜é‡
                currentProvince = province;
                // æ¸…ç©ºå½“å‰åŸå¸‚å˜é‡ï¼ˆé€‰æ‹©æ–°çœä»½æ—¶æ¸…ç©ºåŸå¸‚é€‰æ‹©ï¼‰
                currentCity = '';
                
                // ä¿å­˜ç”¨æˆ·åå¥½
                // è°ƒç”¨userDataManagerçš„saveUserPreferencesæ–¹æ³•ï¼Œä¿å­˜ç”¨æˆ·çš„ç­›é€‰åå¥½
                userDataManager.saveUserPreferences(currentProvince, currentCity, '');
                
                // åˆ¤æ–­æ˜¯å¦é€‰æ‹©äº†çœä»½
                if (province) {
                    // å¦‚æœé€‰æ‹©äº†çœä»½ï¼Œè°ƒç”¨loadCitieså‡½æ•°åŠ è½½è¯¥çœä»½çš„åŸå¸‚åˆ—è¡¨
                    loadCities(province);
                // å¦‚æœæœªé€‰æ‹©çœä»½
                } else {
                    // è·å–åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†å…ƒç´ 
                    const citySelect = document.getElementById('citySelect');
                    // é‡ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºé»˜è®¤é€‰é¡¹
                    citySelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>';
                    // ç¦ç”¨åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†
                    citySelect.disabled = true;
                }
                
                // é‡æ–°åŠ è½½æ™¯ç‚¹æ•°æ®
                // è°ƒç”¨loadAttractionså‡½æ•°ï¼Œæ ¹æ®æ–°çš„ç­›é€‰æ¡ä»¶åŠ è½½æ™¯ç‚¹æ•°æ®
                loadAttractions();
            });

            // åŸå¸‚é€‰æ‹©å˜åŒ–
            // ä¸ºåŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ç»‘å®šchangeäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('citySelect').addEventListener('change', function() {
                // è·å–å½“å‰é€‰æ‹©çš„åŸå¸‚å€¼ï¼Œå¹¶æ›´æ–°å½“å‰åŸå¸‚å˜é‡
                currentCity = this.value;
                
                // è°ƒè¯•ä¿¡æ¯ï¼šæ‰“å°åŸå¸‚é€‰æ‹©å˜åŒ–
                console.log('åŸå¸‚é€‰æ‹©å˜åŒ– - çœä»½:', currentProvince, 'åŸå¸‚:', currentCity);
                
                // ä¿å­˜ç”¨æˆ·åå¥½
                // è°ƒç”¨userDataManagerçš„saveUserPreferencesæ–¹æ³•ï¼Œä¿å­˜ç”¨æˆ·çš„ç­›é€‰åå¥½
                userDataManager.saveUserPreferences(currentProvince, currentCity, '');
                
                // é‡æ–°åŠ è½½æ™¯ç‚¹æ•°æ®
                // è°ƒç”¨loadAttractionså‡½æ•°ï¼Œæ ¹æ®æ–°çš„ç­›é€‰æ¡ä»¶åŠ è½½æ™¯ç‚¹æ•°æ®
                loadAttractions();
            });

            // æœç´¢è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            // ä¸ºæœç´¢è¾“å…¥æ¡†ç»‘å®škeypressäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                // åˆ¤æ–­æ˜¯å¦æŒ‰ä¸‹å›è½¦é”®
                if (e.key === 'Enter') {
                    // å¦‚æœæŒ‰ä¸‹å›è½¦é”®ï¼Œè°ƒç”¨searchAttractionså‡½æ•°æ‰§è¡Œæœç´¢
                    searchAttractions();
                }
            });
        }

        /**
         * åŠ è½½çœä»½åˆ—è¡¨ï¼ˆæ”¯æŒç¼“å­˜ï¼‰
         * åŠŸèƒ½æ¦‚è¿°ï¼šåŠ è½½çœä»½åˆ—è¡¨ï¼Œä¼˜å…ˆä»localStorageç¼“å­˜è·å–ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸåˆ™ä»æœåŠ¡å™¨è·å–
         */
        function loadProvinces() {
            // å…ˆå°è¯•ä»ç¼“å­˜è·å–
            // è°ƒç”¨userDataManagerçš„getCachedProvincesæ–¹æ³•ï¼Œå°è¯•ä»localStorageè·å–ç¼“å­˜çš„çœä»½æ•°æ®
            const cachedProvinces = userDataManager.getCachedProvinces();
            // åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ä¸”æœªè¿‡æœŸ
            if (cachedProvinces) {
                // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥ç¼“å­˜æ•°æ®
                console.log('ä»ç¼“å­˜è·å–çœä»½æ•°æ®:', cachedProvinces);
                console.log('ç¼“å­˜çœä»½æ•°é‡:', cachedProvinces ? cachedProvinces.length : 0);
                
                // æ£€æŸ¥ç¼“å­˜æ•°æ®æ˜¯å¦å®Œæ•´ï¼ˆåº”è¯¥æœ‰34ä¸ªçœä»½ï¼Œä¸åŒ…æ‹¬"å›½å¤–"ï¼‰
                // å¦‚æœç¼“å­˜æ•°æ®ä¸å®Œæ•´ï¼ˆå°‘äº30ä¸ªï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°è·å–
                if (!cachedProvinces || cachedProvinces.length < 30) {
                    console.warn('ç¼“å­˜æ•°æ®ä¸å®Œæ•´ï¼ˆåªæœ‰' + (cachedProvinces ? cachedProvinces.length : 0) + 'ä¸ªçœä»½ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°è·å–');
                    // æ¸…é™¤çœä»½ç¼“å­˜ï¼ˆä½¿ç”¨userDataManagerçš„å­˜å‚¨é”®åï¼‰
                    localStorage.removeItem(userDataManager.storageKeys.provincesCache);
                    // ç»§ç»­æ‰§è¡Œï¼Œä»æœåŠ¡å™¨è·å–
                } else {
                    // å¦‚æœç¼“å­˜å­˜åœ¨ä¸”å®Œæ•´ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®å¡«å……çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†
                    populateProvinceSelect(cachedProvinces);
                    
                    // æ¢å¤çœä»½é€‰æ‹©
                    // åˆ¤æ–­æ˜¯å¦æœ‰ä¿å­˜çš„çœä»½åå¥½
                    if (currentProvince) {
                        // å¦‚æœæœ‰çœä»½åå¥½ï¼Œè®¾ç½®çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†çš„å€¼ä¸ºåå¥½å€¼
                        document.getElementById('provinceSelect').value = currentProvince;
                        // è°ƒç”¨loadCitieså‡½æ•°ï¼ŒåŠ è½½è¯¥çœä»½çš„åŸå¸‚åˆ—è¡¨
                        loadCities(currentProvince);
                    }
                    // ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œ
                    return;
                }
            }

            // ç¼“å­˜ä¸å­˜åœ¨ï¼Œä»æœåŠ¡å™¨è·å–
            // ä½¿ç”¨fetch APIå‘é€GETè¯·æ±‚åˆ°åç«¯çœä»½æ¥å£
            fetch('/travel/api/addressProvinces')
                .then(response => response.json())  // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                .then(data => {
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸ
                    if (data.success) {
                        // è°ƒè¯•ä¿¡æ¯ï¼šæ‰“å°çœä»½æ•°æ®
                        console.log('è·å–åˆ°çš„çœä»½æ•°æ®:', data.provinces);
                        console.log('çœä»½æ€»æ•°:', data.provinces ? data.provinces.length : 0);
                        console.log('åç«¯è¿”å›çš„total:', data.total);
                        
                        // ç¼“å­˜æ•°æ®
                        // è°ƒç”¨userDataManagerçš„cacheProvincesæ–¹æ³•ï¼Œå°†çœä»½æ•°æ®ä¿å­˜åˆ°localStorageç¼“å­˜
                        userDataManager.cacheProvinces(data.provinces);
                        
                        // ä½¿ç”¨æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¡«å……çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†
                        populateProvinceSelect(data.provinces);
                        
                        // éªŒè¯å¡«å……åçš„é€‰é¡¹æ•°é‡
                        const select = document.getElementById('provinceSelect');
                        console.log('å¡«å……åçš„é€‰é¡¹æ•°é‡:', select.options.length);
                        
                        // æ¢å¤çœä»½é€‰æ‹©
                        // åˆ¤æ–­æ˜¯å¦æœ‰ä¿å­˜çš„çœä»½åå¥½
                        if (currentProvince) {
                            // å¦‚æœæœ‰çœä»½åå¥½ï¼Œè®¾ç½®çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†çš„å€¼ä¸ºåå¥½å€¼
                            document.getElementById('provinceSelect').value = currentProvince;
                            // è°ƒç”¨loadCitieså‡½æ•°ï¼ŒåŠ è½½è¯¥çœä»½çš„åŸå¸‚åˆ—è¡¨
                            loadCities(currentProvince);
                        }
                    } else {
                        console.error('è·å–çœä»½å¤±è´¥:', data.message);
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                    console.error('åŠ è½½çœä»½å¤±è´¥:', error);
                });
        }

        /**
         * å¡«å……çœä»½é€‰æ‹©æ¡†
         * åŠŸèƒ½æ¦‚è¿°ï¼šå°†çœä»½æ•°æ®å¡«å……åˆ°çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
         * @param {Array} provinces - çœä»½åç§°æ•°ç»„
         */
        function populateProvinceSelect(provinces) {
            // è·å–çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†å…ƒç´ 
            const select = document.getElementById('provinceSelect');
            // é‡ç½®çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºé»˜è®¤é€‰é¡¹
            select.innerHTML = '<option value="">æ‰€æœ‰çœä»½</option>';
            
            // æ£€æŸ¥provincesæ˜¯å¦ä¸ºæ•°ç»„ä¸”ä¸ä¸ºç©º
            if (!provinces || !Array.isArray(provinces) || provinces.length === 0) {
                console.error('çœä»½æ•°æ®æ— æ•ˆ:', provinces);
                return;
            }
            
            // éå†çœä»½æ•°ç»„ï¼Œä¸ºæ¯ä¸ªçœä»½åˆ›å»ºé€‰é¡¹å¹¶æ·»åŠ åˆ°ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
            provinces.forEach((province, index) => {
                // æ£€æŸ¥çœä»½åç§°æ˜¯å¦æœ‰æ•ˆ
                if (!province || province.trim() === '') {
                    console.warn('è·³è¿‡æ— æ•ˆçš„çœä»½:', province, 'ç´¢å¼•:', index);
                    return;
                }
                
                // åˆ›å»ºoptionå…ƒç´ 
                const option = document.createElement('option');
                // è®¾ç½®optionçš„valueå±æ€§ä¸ºçœä»½åç§°
                option.value = province;
                // è®¾ç½®optionçš„æ–‡æœ¬å†…å®¹ä¸ºçœä»½åç§°
                option.textContent = province;
                // å°†optionæ·»åŠ åˆ°çœä»½ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
                select.appendChild(option);
            });
            
            // è°ƒè¯•ä¿¡æ¯ï¼šéªŒè¯æ‰€æœ‰é€‰é¡¹éƒ½å·²æ·»åŠ 
            console.log('çœä»½ä¸‹æ‹‰èœå•å¡«å……å®Œæˆï¼Œæ€»é€‰é¡¹æ•°:', select.options.length);
            console.log('æ‰€æœ‰çœä»½é€‰é¡¹:', Array.from(select.options).map(opt => opt.textContent));
        }

        /**
         * åŠ è½½åŸå¸‚åˆ—è¡¨ï¼ˆæ”¯æŒç¼“å­˜ï¼‰
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®çœä»½åŠ è½½åŸå¸‚åˆ—è¡¨ï¼Œä¼˜å…ˆä»localStorageç¼“å­˜è·å–ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸåˆ™ä»æœåŠ¡å™¨è·å–
         * @param {String} province - çœä»½åç§°
         */
        function loadCities(province) {
            // è·å–åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†å…ƒç´ 
            const citySelect = document.getElementById('citySelect');
            // è®¾ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºåŠ è½½ä¸­æç¤º
            citySelect.innerHTML = '<option value="">åŠ è½½ä¸­...</option>';
            // ç¦ç”¨åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ˆåŠ è½½æœŸé—´ç¦ç”¨ï¼‰
            citySelect.disabled = true;

            // å…ˆå°è¯•ä»ç¼“å­˜è·å–
            // è°ƒç”¨userDataManagerçš„getCachedCitiesæ–¹æ³•ï¼Œå°è¯•ä»localStorageè·å–ç¼“å­˜çš„è¯¥çœä»½åŸå¸‚æ•°æ®
            const cachedCities = userDataManager.getCachedCities(province);
            // åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ä¸”æœªè¿‡æœŸ
            if (cachedCities) {
                // å¦‚æœç¼“å­˜å­˜åœ¨ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®å¡«å……åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†
                populateCitySelect(cachedCities);
                
                // æ¢å¤åŸå¸‚é€‰æ‹©
                // åˆ¤æ–­æ˜¯å¦æœ‰ä¿å­˜çš„åŸå¸‚åå¥½
                if (currentCity) {
                    // å¦‚æœæœ‰åŸå¸‚åå¥½ï¼Œè®¾ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„å€¼ä¸ºåå¥½å€¼
                    citySelect.value = currentCity;
                }
                // ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œ
                return;
            }

            // ç¼“å­˜ä¸å­˜åœ¨ï¼Œä»æœåŠ¡å™¨è·å–
            // ä½¿ç”¨fetch APIå‘é€GETè¯·æ±‚åˆ°åç«¯åŸå¸‚æ¥å£ï¼Œä¼ é€’çœä»½å‚æ•°ï¼ˆä½¿ç”¨encodeURIComponentç¼–ç ï¼‰
            fetch(`/travel/api/addressCities?province=${encodeURIComponent(province)}`)
                .then(response => response.json())  // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                .then(data => {
                    // è°ƒè¯•ä¿¡æ¯ï¼šæ‰“å°åŸå¸‚æ•°æ®
                    console.log('è·å–åˆ°çš„åŸå¸‚æ•°æ®:', data);
                    console.log('åŸå¸‚æ€»æ•°:', data.cities ? data.cities.length : 0);
                    
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸä¸”åŸå¸‚æ•°ç»„ä¸ä¸ºç©º
                    if (data.success && data.cities && data.cities.length > 0) {
                        // ç¼“å­˜æ•°æ®
                        // è°ƒç”¨userDataManagerçš„cacheCitiesæ–¹æ³•ï¼Œå°†åŸå¸‚æ•°æ®ä¿å­˜åˆ°localStorageç¼“å­˜
                        userDataManager.cacheCities(province, data.cities);
                        
                        // ä½¿ç”¨æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¡«å……åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†
                        populateCitySelect(data.cities);
                        
                        // æ¢å¤åŸå¸‚é€‰æ‹©
                        // åˆ¤æ–­æ˜¯å¦æœ‰ä¿å­˜çš„åŸå¸‚åå¥½
                        if (currentCity) {
                            // å¦‚æœæœ‰åŸå¸‚åå¥½ï¼Œè®¾ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„å€¼ä¸ºåå¥½å€¼
                            citySelect.value = currentCity;
                        }
                    // å¦‚æœåç«¯è¿”å›æˆåŠŸä½†åŸå¸‚æ•°ç»„ä¸ºç©º
                    } else {
                        console.warn('åŸå¸‚æ•°æ®ä¸ºç©ºæˆ–è·å–å¤±è´¥:', data);
                        // è®¾ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºæš‚æ— åŸå¸‚æ•°æ®æç¤º
                        citySelect.innerHTML = '<option value="">æš‚æ— åŸå¸‚æ•°æ®</option>';
                        // ç¦ç”¨åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†
                        citySelect.disabled = true;
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                    console.error('åŠ è½½åŸå¸‚å¤±è´¥:', error);
                    // è®¾ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºåŠ è½½å¤±è´¥æç¤º
                    citySelect.innerHTML = '<option value="">åŠ è½½å¤±è´¥</option>';
                    // ç¦ç”¨åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†
                    citySelect.disabled = true;
                });
        }

        /**
         * å¡«å……åŸå¸‚é€‰æ‹©æ¡†
         * åŠŸèƒ½æ¦‚è¿°ï¼šå°†åŸå¸‚æ•°æ®å¡«å……åˆ°åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
         * @param {Array} cities - åŸå¸‚åç§°æ•°ç»„
         */
        function populateCitySelect(cities) {
            // è·å–åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†å…ƒç´ 
            const citySelect = document.getElementById('citySelect');
            // é‡ç½®åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†çš„é€‰é¡¹ä¸ºé»˜è®¤é€‰é¡¹
            citySelect.innerHTML = '<option value="">æ‰€æœ‰åŸå¸‚</option>';
            
            // æ£€æŸ¥citiesæ˜¯å¦ä¸ºæ•°ç»„ä¸”ä¸ä¸ºç©º
            if (!cities || !Array.isArray(cities) || cities.length === 0) {
                console.error('åŸå¸‚æ•°æ®æ— æ•ˆ:', cities);
                citySelect.innerHTML = '<option value="">æš‚æ— åŸå¸‚æ•°æ®</option>';
                citySelect.disabled = true;
                return;
            }
            
            // éå†åŸå¸‚æ•°ç»„ï¼Œä¸ºæ¯ä¸ªåŸå¸‚åˆ›å»ºé€‰é¡¹å¹¶æ·»åŠ åˆ°ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
            cities.forEach((city, index) => {
                // æ£€æŸ¥åŸå¸‚åç§°æ˜¯å¦æœ‰æ•ˆ
                if (!city || city.trim() === '') {
                    console.warn('è·³è¿‡æ— æ•ˆçš„åŸå¸‚:', city, 'ç´¢å¼•:', index);
                    return;
                }
                
                // åˆ›å»ºoptionå…ƒç´ 
                const option = document.createElement('option');
                // è®¾ç½®optionçš„valueå±æ€§ä¸ºåŸå¸‚åç§°
                option.value = city;
                // è®¾ç½®optionçš„æ–‡æœ¬å†…å®¹ä¸ºåŸå¸‚åç§°
                option.textContent = city;
                // å°†optionæ·»åŠ åˆ°åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ä¸­
                citySelect.appendChild(option);
            });
            
            // å¯ç”¨åŸå¸‚ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ˆåŠ è½½å®Œæˆåå¯ç”¨ï¼‰
            citySelect.disabled = false;
            
            // è°ƒè¯•ä¿¡æ¯ï¼šéªŒè¯æ‰€æœ‰é€‰é¡¹éƒ½å·²æ·»åŠ 
            console.log('åŸå¸‚ä¸‹æ‹‰èœå•å¡«å……å®Œæˆï¼Œæ€»é€‰é¡¹æ•°:', citySelect.options.length);
            console.log('æ‰€æœ‰åŸå¸‚é€‰é¡¹:', Array.from(citySelect.options).map(opt => opt.textContent));
        }

        /**
         * åŠ è½½æ™¯ç‚¹æ•°æ®
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶ï¼ˆçœä»½ã€åŸå¸‚ã€åˆ†ç±»ï¼‰åŠ è½½æ™¯ç‚¹æ•°æ®ï¼Œæ”¯æŒå¤šç§APIæ¥å£
         */
        function loadAttractions() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            // è°ƒç”¨showLoadingå‡½æ•°ï¼Œæ˜¾ç¤ºåŠ è½½ä¸­æç¤º
            showLoading();
            
            // åˆå§‹åŒ–API URLå˜é‡
            let url;
            
            // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
            console.log('å¼€å§‹åŠ è½½æ™¯ç‚¹æ•°æ®...');
            console.log('å½“å‰çŠ¶æ€ - çœä»½:', currentProvince || '(ç©º)', 'åŸå¸‚:', currentCity || '(ç©º)');
            
            // â­ ç‰¹åˆ«åˆ¤å®šï¼šæ‰€æœ‰çœä»½çš„æƒ…å†µ
            // åˆ¤æ–­æ˜¯å¦æœªé€‰æ‹©çœä»½æˆ–é€‰æ‹©"æ‰€æœ‰çœä»½"
            if (!currentProvince || currentProvince === '' || currentProvince === 'æ‰€æœ‰çœä»½') {
                // ğŸŒŸ ç‰¹åˆ«å¤„ç†ï¼šå½“é€‰æ‹©"æ‰€æœ‰çœä»½"æ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ™¯ç‚¹æ•°æ®
                // è®¾ç½®API URLä¸ºæ‰€æœ‰çœä»½æ™¯ç‚¹æ¥å£ï¼ˆé™åˆ¶500æ¡ï¼‰
                url = '/travel/api/allProvincesAttractions?limit=500';
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('ç‰¹åˆ«åˆ¤å®šè§¦å‘ï¼šæ‰€æœ‰çœä»½æ™¯ç‚¹API');
                
            // åˆ¤æ–­æ˜¯å¦é€‰æ‹©äº†å…·ä½“çœä»½ä½†æœªé€‰æ‹©åŸå¸‚æˆ–é€‰æ‹©"æ‰€æœ‰åŸå¸‚"
            } else if (currentProvince && (!currentCity || currentCity === '' || currentCity === 'æ‰€æœ‰åŸå¸‚')) {
                // é€‰æ‹©äº†å…·ä½“çœä»½ä½†é€‰æ‹©"æ‰€æœ‰åŸå¸‚"
                // è®¾ç½®API URLä¸ºçœä»½æ‰€æœ‰åŸå¸‚æ™¯ç‚¹æ¥å£ï¼ˆä¼ é€’çœä»½å‚æ•°ï¼Œé™åˆ¶200æ¡ï¼Œä½¿ç”¨encodeURIComponentç¼–ç ï¼‰
                url = `/travel/api/provinceAllCitiesAttractions?province=${encodeURIComponent(currentProvince)}&limit=200`;
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('è°ƒç”¨çœä»½æ‰€æœ‰åŸå¸‚æ™¯ç‚¹API');
                
            // åˆ¤æ–­æ˜¯å¦é€‰æ‹©äº†å…·ä½“çœä»½å’ŒåŸå¸‚
            } else if (currentProvince && currentCity && currentCity !== 'æ‰€æœ‰åŸå¸‚' && currentCity !== '') {
                // é€‰æ‹©äº†å…·ä½“çœä»½å’ŒåŸå¸‚
                // åˆ›å»ºURLSearchParamså¯¹è±¡ï¼Œç”¨äºæ„å»ºæŸ¥è¯¢å‚æ•°
                const params = new URLSearchParams();
                // æ·»åŠ çœä»½å‚æ•°
                params.append('province', currentProvince);
                // æ·»åŠ åŸå¸‚å‚æ•°
                params.append('city', currentCity);
                
                // è®¾ç½®API URLä¸ºå…·ä½“çœä»½åŸå¸‚æ¥å£ï¼ˆä¼ é€’æŸ¥è¯¢å‚æ•°ï¼‰
                url = `/travel/api/locationInfo?${params.toString()}`;
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('è°ƒç”¨å…·ä½“çœä»½åŸå¸‚API - çœä»½:', currentProvince, 'åŸå¸‚:', currentCity);
                console.log('API URL:', url);
                
            // å…¶ä»–æƒ…å†µï¼ˆå¤‡ç”¨ï¼‰
            } else {
                // å¤‡ç”¨æƒ…å†µ
                // è®¾ç½®API URLä¸ºæ‰€æœ‰æ™¯ç‚¹æ¥å£ï¼ˆé™åˆ¶200æ¡ï¼‰
                url = '/travel/api/allAttractions?limit=200';
                // æ‰“å°è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
                console.log('è°ƒç”¨å¤‡ç”¨æ‰€æœ‰æ™¯ç‚¹API');
            }
            
            // æ‰“å°æœ€ç»ˆAPI URLåˆ°æ§åˆ¶å°
            console.log('æœ€ç»ˆAPI URL:', url);
            
            // ä½¿ç”¨fetch APIå‘é€GETè¯·æ±‚åˆ°åç«¯æ™¯ç‚¹æ¥å£
            fetch(url)
                .then(response => {
                    // æ‰“å°APIå“åº”çŠ¶æ€åˆ°æ§åˆ¶å°
                    console.log('APIå“åº”çŠ¶æ€:', response.status);
                    
                    // åˆ¤æ–­å“åº”æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç 200-299ï¼‰
                    if (!response.ok) {
                        // å¦‚æœå“åº”ä¸æˆåŠŸï¼ŒæŠ›å‡ºé”™è¯¯
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                    return response.json();
                })
                .then(data => {
                    // æ‰“å°APIè¿”å›å®Œæ•´æ•°æ®åˆ°æ§åˆ¶å°
                    console.log('APIè¿”å›å®Œæ•´æ•°æ®:', data);
                    console.log('APIè¿”å›çš„å­—æ®µ:', Object.keys(data));
                    
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸ
                    if (data.success) {
                        // è·å–æ™¯ç‚¹æ•°ç»„ï¼ˆå…¼å®¹ä¸åŒçš„æ•°æ®å­—æ®µåï¼‰
                        // locationInfo APIè¿”å›çš„æ˜¯addressAttractionså­—æ®µ
                        const attractions = data.addressAttractions || data.attractions || [];
                        // æ‰“å°è·å–åˆ°çš„æ™¯ç‚¹æ•°é‡åˆ°æ§åˆ¶å°
                        console.log('è·å–åˆ°çš„æ™¯ç‚¹æ•°é‡:', attractions.length);
                        console.log('addressAttractionsæ•°é‡:', data.addressAttractions ? data.addressAttractions.length : 0);
                        console.log('attractionsæ•°é‡:', data.attractions ? data.attractions.length : 0);
                        
                        // åˆ¤æ–­æ™¯ç‚¹æ•°ç»„æ˜¯å¦ä¸ºç©º
                        if (attractions.length === 0) {
                            // å¦‚æœæ™¯ç‚¹æ•°ç»„ä¸ºç©ºï¼Œæ‰“å°è­¦å‘Šä¿¡æ¯åˆ°æ§åˆ¶å°
                            console.warn('è­¦å‘Šï¼šAPIè¿”å›æˆåŠŸä½†æ™¯ç‚¹æ•°ç»„ä¸ºç©º');
                            console.warn('æ£€æŸ¥æ•°æ®:', {
                                addressAttractions: data.addressAttractions,
                                attractions: data.attractions,
                                province: currentProvince,
                                city: currentCity
                            });
                            // æ˜¾ç¤ºæ— ç»“æœæç¤º
                            showNoResults('æ²¡æœ‰æ‰¾åˆ°æ™¯ç‚¹æ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æ•°æ®');
                        // å¦‚æœæ™¯ç‚¹æ•°ç»„ä¸ä¸ºç©º
                        } else {
                            // æ‰“å°å‰5ä¸ªæ™¯ç‚¹è¯¦æƒ…åˆ°æ§åˆ¶å°ï¼ˆç”¨äºè°ƒè¯•ï¼‰
                            console.log('å‰5ä¸ªæ™¯ç‚¹è¯¦æƒ…:', attractions.slice(0, 5));
                            // è°ƒç”¨displayAttractionså‡½æ•°ï¼Œæ˜¾ç¤ºæ™¯ç‚¹åˆ—è¡¨
                            displayAttractions(attractions);
                        }
                    // å¦‚æœåç«¯è¿”å›å¤±è´¥
                    } else {
                        // æ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                        console.error('APIè¿”å›å¤±è´¥:', data.message);
                        // æ˜¾ç¤ºæ— ç»“æœæç¤ºï¼ˆåŒ…å«é”™è¯¯ä¿¡æ¯ï¼‰
                        showNoResults(`APIé”™è¯¯: ${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                    console.error('åŠ è½½æ™¯ç‚¹å¤±è´¥:', error);
                    // æ˜¾ç¤ºæ— ç»“æœæç¤ºï¼ˆåŒ…å«é”™è¯¯ä¿¡æ¯ï¼‰
                    showNoResults(`ç½‘ç»œé”™è¯¯: ${error.message}<br>è¯·ç¡®ä¿åº”ç”¨å·²å¯åŠ¨å¹¶æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—`);
                });
        }

        // æœç´¢æ™¯ç‚¹ï¼ˆå¢å¼ºç‰ˆï¼Œæ”¯æŒæœç´¢å†å²ï¼‰
        function searchAttractions() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            // ä¿å­˜æœç´¢å†å²
            userDataManager.saveSearchHistory(keyword);
            
            showLoading();
            
            // ç®€å•çš„æœç´¢æ¨¡æ‹Ÿ
            fetch(`/travel/api/locationInfo?province=${encodeURIComponent(keyword)}`)
                    .then(response => response.json())
                    .then(data => {
                    if (data.success && (data.attractions || data.addressAttractions)) {
                        const attractions = data.attractions || data.addressAttractions || [];
                        displayAttractions(attractions);
                        } else {
                        showNoResults('æœªæ‰¾åˆ°ç›¸å…³æ™¯ç‚¹');
                        }
                    })
                    .catch(error => {
                    console.error('æœç´¢å¤±è´¥:', error);
                    showNoResults('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
        }

        // æ˜¾ç¤ºæ™¯ç‚¹åˆ—è¡¨
        function displayAttractions(attractions) {
            const container = document.getElementById('attractionsContainer');
            
            if (!attractions || attractions.length === 0) {
                showNoResults('æš‚æ— æ™¯ç‚¹æ•°æ®');
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'attractions-grid';
            
            // å¦‚æœæ˜¯addressè¡¨çš„æ•°æ®æ ¼å¼ï¼Œéœ€è¦è½¬æ¢
            attractions.forEach(attraction => {
                const card = createAttractionCard(attraction);
                grid.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }

        // åˆ›å»ºæ™¯ç‚¹å¡ç‰‡ï¼ˆå¢å¼ºç‰ˆï¼Œæ”¯æŒæ”¶è—åŠŸèƒ½ï¼‰
        function createAttractionCard(attraction) {
            const card = document.createElement('div');
            card.className = 'attraction-card';
            
            // å¤„ç†ä¸åŒæ•°æ®æºçš„å­—æ®µ
            const name = attraction.name || attraction.title || 'æœªçŸ¥æ™¯ç‚¹';
            const description = attraction.description || attraction.content || 'æš‚æ— ä»‹ç»';
            const province = attraction.province || '';
            const city = attraction.city || '';
            const rating = attraction.rating || '4.5';
            const priceRange = attraction.priceRange || attraction.price_range || 'å…è´¹';
            const features = attraction.features || '';
            const tips = attraction.tips || '';
            const openingHours = attraction.opening_hours || '';
            const viewCount = attraction.view_count || Math.floor(Math.random() * 1000) + 100;
            const likeCount = attraction.like_count || Math.floor(Math.random() * 100) + 20;
            
            // ä½¿ç”¨çœŸå®çš„å›¾ç‰‡URLæˆ–éšæœºé»˜è®¤å›¾ç‰‡
            const imageUrl = attraction.image_url || getRandomDefaultImage();
            
            // æˆªå–æè¿°åˆ°åˆé€‚é•¿åº¦
            const shortDescription = description.length > 100 ? description.substring(0, 100) + '...' : description;
            
            // å¤„ç†ç‰¹è‰²æ ‡ç­¾
            const featureTags = features ? features.split(',').slice(0, 2) : ['æ¨è', 'å¿…æ¸¸'];
            
            // æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
            const isFavorited = userDataManager.isFavorite(name);
            const favoriteIcon = isFavorited ? 'fas fa-heart' : 'far fa-heart';
            const favoriteClass = isFavorited ? 'favorited' : '';
            
            // ç”Ÿæˆå”¯ä¸€çš„å¡ç‰‡ID
            const cardId = 'attraction-card-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            // åˆ›å»ºæ ‡å‡†åŒ–çš„æ™¯ç‚¹æ•°æ®å¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼
            const standardizedAttraction = {
                ...attraction,
                name: name,  // ä½¿ç”¨å¤„ç†è¿‡çš„åç§°
                description: description,  // ä½¿ç”¨å¤„ç†è¿‡çš„æè¿°
                province: province,
                city: city,
                rating: rating,
                priceRange: priceRange,
                price_range: priceRange,  // ä¿æŒå…¼å®¹æ€§
                features: features,
                tips: tips,
                opening_hours: openingHours,
                openingHours: openingHours,  // ä¿æŒå…¼å®¹æ€§
                view_count: viewCount,
                like_count: likeCount,
                image_url: imageUrl,
                imageUrl: imageUrl  // ä¿æŒå…¼å®¹æ€§
            };
            
            // å°†æ ‡å‡†åŒ–çš„æ™¯ç‚¹æ•°æ®å­˜å‚¨åˆ°å…¨å±€å¯¹è±¡ä¸­
            currentAttractions[cardId] = standardizedAttraction;
            
            // ç»™å¡ç‰‡æ·»åŠ  data-card-id å±æ€§ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾
            card.setAttribute('data-card-id', cardId);
            
            card.innerHTML = `
                <div class="card-image">
                    <img src="${imageUrl}" alt="${name}" onerror="this.src=getRandomDefaultImage()">
                    <div class="card-badge">çƒ­é—¨æ™¯ç‚¹</div>
                    <div class="rating-badge">
                        <i class="fas fa-star"></i> ${rating}
                    </div>
                    <div class="favorite-btn ${favoriteClass}" onclick="toggleFavorite('${name}', this)" title="${isFavorited ? 'å–æ¶ˆæ”¶è—' : 'æ·»åŠ æ”¶è—'}">
                        <i class="${favoriteIcon}"></i>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${name}</div>
                            <div class="card-location">
                                <i class="fas fa-map-marker-alt"></i>
                                ${province} ${city}
                            </div>
                        </div>
                        <div class="card-price">${priceRange}</div>
                    </div>
                    <div class="card-description">${shortDescription}</div>
                    ${openingHours ? `<div class="card-info"><i class="fas fa-clock"></i> ${openingHours}</div>` : ''}
                    <div class="card-tags">
                        ${featureTags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <div class="card-footer">
                        <div class="card-stats">
                            <div class="stat-item">
                                <i class="fas fa-eye"></i>
                                <span>${viewCount}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span>${likeCount}</span>
                            </div>
                        </div>
                        <button class="view-btn" onclick="viewAttractionDetailByCard('${cardId}')">
                            æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // é€šè¿‡å¡ç‰‡IDæŸ¥çœ‹æ™¯ç‚¹è¯¦æƒ…
        function viewAttractionDetailByCard(cardId) {
            const attraction = currentAttractions[cardId];
            if (!attraction) {
                console.error('âŒ æœªæ‰¾åˆ°æ™¯ç‚¹æ•°æ®:', cardId);
                alert('æ— æ³•è·å–æ™¯ç‚¹ä¿¡æ¯ï¼Œè¯·é‡è¯•');
                return;
            }
            
            const name = attraction.name || attraction.title || 'æœªçŸ¥æ™¯ç‚¹';
            viewAttractionDetail(name, attraction);
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        function toggleFavorite(attractionName, element) {
            // ä»å¡ç‰‡ä¸­è·å–å®Œæ•´çš„æ™¯ç‚¹æ•°æ®
            const card = element.closest('.attraction-card');
            const cardId = card.getAttribute('data-card-id');
            let attractionData = null;
            
            // ä¼˜å…ˆä» currentAttractions ä¸­è·å–å®Œæ•´æ•°æ®
            if (cardId && currentAttractions[cardId]) {
                attractionData = currentAttractions[cardId];
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä»DOMä¸­æå–æ•°æ®ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
                const title = card.querySelector('.card-title')?.textContent || attractionName;
                const location = card.querySelector('.card-location')?.textContent.trim() || '';
                const description = card.querySelector('.card-description')?.textContent || '';
                
                attractionData = {
                    name: title,
                    location: location,
                    description: description
                };
            }
            
            // åˆ‡æ¢æ”¶è—çŠ¶æ€
            const isFavorited = userDataManager.toggleFavorite(attractionName, attractionData);
            
            // æ›´æ–°UI
            const icon = element.querySelector('i');
            if (isFavorited) {
                icon.className = 'fas fa-heart';
                element.classList.add('favorited');
                element.title = 'å–æ¶ˆæ”¶è—';
                
                // ç®€å•çš„æ”¶è—åŠ¨ç”»
                element.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 200);
            } else {
                icon.className = 'far fa-heart';
                element.classList.remove('favorited');
                element.title = 'æ·»åŠ æ”¶è—';
            }
        }

        // æŸ¥çœ‹æ™¯ç‚¹è¯¦æƒ…ï¼ˆå¢å¼ºç‰ˆï¼Œæ”¯æŒæµè§ˆå†å²ï¼‰
        function viewAttractionDetail(name, attractionData) {
            console.log('ğŸ” æŸ¥çœ‹æ™¯ç‚¹è¯¦æƒ…:', name);
            console.log('ğŸ“Š æ™¯ç‚¹æ•°æ®:', attractionData);
            
            // å°†æ™¯ç‚¹æ•°æ®ä¸´æ—¶ä¿å­˜åˆ°localStorageï¼Œä¾›è¯¦æƒ…é¡µä½¿ç”¨
            const tempKey = 'xihu_temp_attraction_' + Date.now();
            try {
                localStorage.setItem(tempKey, JSON.stringify(attractionData));
                console.log('âœ… æ™¯ç‚¹æ•°æ®å·²ä¸´æ—¶ä¿å­˜åˆ°localStorage');
            } catch (error) {
                console.warn('âš ï¸ ä¿å­˜æ™¯ç‚¹æ•°æ®åˆ°localStorageå¤±è´¥:', error);
            }
            
            // ä¿å­˜æµè§ˆå†å²
            userDataManager.saveBrowsingHistory(name, attractionData);
            
            // è·³è½¬åˆ°è¯¦æƒ…é¡µé¢ï¼Œä¼ é€’ä¸´æ—¶é”®å
            const detailUrl = `/travel/attraction-detail?name=${encodeURIComponent(name)}&tempKey=${tempKey}`;
            window.location.href = detailUrl;
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('attractionsContainer').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <div>æ­£åœ¨åŠ è½½...</div>
                </div>
            `;
        }

        // æ˜¾ç¤ºæ— ç»“æœ
        function showNoResults(message) {
            document.getElementById('attractionsContainer').innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <div>${message}</div>
                </div>
            `;
        }

        // ===== è°ƒè¯•åŠŸèƒ½ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰=====
        
        // åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹ç”¨æˆ·æ•°æ®çš„å‡½æ•°
        window.getUserData = function() {
            return {
                preferences: userDataManager.getUserPreferences(),
                browsingHistory: userDataManager.getBrowsingHistory(),
                searchHistory: userDataManager.getSearchHistory(),
                favorites: userDataManager.getFavorites(),
                stats: userDataManager.getStorageStats()
            };
        };

        // æ¸…ç©ºç”¨æˆ·æ•°æ®çš„å‡½æ•°ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
        window.clearUserData = function() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                userDataManager.clearAllUserData();
                location.reload();
            }
        };

        // è®¾ç½®å½“å‰é¡µé¢çš„å¯¼èˆªæ¿€æ´»çŠ¶æ€
        function setActiveNavItem() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-links a');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');
                
                // æ ¹æ®å½“å‰è·¯å¾„è®¾ç½®æ¿€æ´»çŠ¶æ€
                if (currentPath === '/' && href === '/') {
                    link.classList.add('active');
                } else if (currentPath.startsWith('/hc/') && href === '/hc/f2') {
                    link.classList.add('active');
                } else if (currentPath.startsWith('/travel') && href === '/travel') {
                    link.classList.add('active');
                } else if (currentPath.startsWith('/food') && href === '/food') {
                    link.classList.add('active');
                } else if (currentPath.startsWith('/shopping') && href === '/shopping') {
                    link.classList.add('active');
                } else if (currentPath.startsWith('/payment') && href === '/payment') {
                    link.classList.add('active');
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®å¯¼èˆªæ¿€æ´»çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            setActiveNavItem();
        });

        console.log('ğŸ’¡ è°ƒè¯•æç¤ºï¼š');
        console.log('- åœ¨æ§åˆ¶å°è¾“å…¥ getUserData() æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·æ•°æ®');
        console.log('- åœ¨æ§åˆ¶å°è¾“å…¥ clearUserData() æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®');
    </script>
    
</body>
</html> 