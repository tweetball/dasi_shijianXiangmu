<!--
    æ–‡ä»¶åç§°ï¼šorderCenterNew.html
    æ–‡ä»¶åŠŸèƒ½ï¼šç»Ÿä¸€è®¢å•ä¸­å¿ƒé¡µé¢æ¨¡æ¿
    åŠŸèƒ½æ¦‚è¿°ï¼š
        1. æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰è®¢å•åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå…¨éƒ¨ã€å¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²å–æ¶ˆã€å·²å®Œæˆï¼‰
        2. æ”¯æŒæŒ‰è®¢å•ç±»å‹ç­›é€‰ï¼ˆå…¨éƒ¨ã€ç¾é£Ÿå¤–å–ã€é…’åº—é¢„è®¢ã€è´­ç‰©å•†åŸã€æ™¯ç‚¹æ—…æ¸¸ã€ç”Ÿæ´»ç¼´è´¹ï¼‰
        3. æä¾›è®¢å•æ“ä½œåŠŸèƒ½ï¼ˆç»§ç»­æ”¯ä»˜ã€å–æ¶ˆè®¢å•ã€åˆ é™¤è®¢å•ã€æŸ¥çœ‹è¯¦æƒ…ï¼‰
        4. åŠ¨æ€åŠ è½½è®¢å•æ•°æ®ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰
        5. å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒPCç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
    æŠ€æœ¯æ ˆï¼šHTML5 + CSS3 + JavaScript + Thymeleafæ¨¡æ¿å¼•æ“
    ä¾èµ–æ–‡ä»¶ï¼šæ— å¤–éƒ¨JavaScriptæ–‡ä»¶ä¾èµ–
    ä½œè€…ï¼šæ¸¸å¸‚ç”Ÿæ´»å¼€å‘å›¢é˜Ÿ
    åˆ›å»ºæ—¥æœŸï¼š2024å¹´
    æœ€åæ›´æ–°ï¼š2024å¹´
-->
<!DOCTYPE html>
<!-- HTML5æ–‡æ¡£ç±»å‹å£°æ˜ï¼Œæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªHTML5æ–‡æ¡£ -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- 
    HTMLæ ¹å…ƒç´ 
    xmlns:th="http://www.thymeleaf.org"ï¼šå£°æ˜Thymeleafå‘½åç©ºé—´ï¼Œç”¨äºæ¨¡æ¿å¼•æ“è¯­æ³•
-->
<head>
    <!-- HTMLæ–‡æ¡£å¤´éƒ¨ï¼ŒåŒ…å«å…ƒæ•°æ®å’Œæ ·å¼è¡¨å¼•ç”¨ -->
    <!-- å­—ç¬¦ç¼–ç å£°æ˜ï¼ŒæŒ‡å®šé¡µé¢ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒä¸­æ–‡ç­‰å¤šè¯­è¨€å­—ç¬¦ -->
    <meta charset="UTF-8">
    <!-- è§†å£å…ƒæ•°æ®ï¼Œè®¾ç½®é¡µé¢åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤ºæ–¹å¼ï¼Œwidth=device-widthè¡¨ç¤ºå®½åº¦è‡ªé€‚åº”è®¾å¤‡å®½åº¦ï¼Œinitial-scale=1.0è¡¨ç¤ºåˆå§‹ç¼©æ”¾æ¯”ä¾‹ä¸º1.0 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <title>æˆ‘çš„è®¢å• - è¥¿æ¹–æ—…æ¸¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .order-center-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .page-header h1 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #7f8c8d;
            font-size: 16px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-tab:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }

        .filter-tab.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .order-list {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .order-card {
            border-bottom: 1px solid #eee;
            padding: 20px;
            transition: background-color 0.3s;
        }

        .order-card:hover {
            background-color: #f8f9fa;
        }

        .order-card:last-child {
            border-bottom: none;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-number {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-unpaid {
            background: #fff3cd;
            color: #856404;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .order-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-info {
            flex: 1;
        }

        .order-type {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .order-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .order-description {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .order-amount {
            font-size: 20px;
            font-weight: 700;
            color: #e74c3c;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-time {
            font-size: 12px;
            color: #7f8c8d;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-outline {
            background: transparent;
            color: #6c757d;
            border: 1px solid #6c757d;
        }

        .btn-outline:hover {
            background: #6c757d;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .empty-state-desc {
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .order-center-container {
                padding: 10px;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .order-body {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .order-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .filter-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="order-center-container">
        <div class="page-header">
            <h1>æˆ‘çš„è®¢å•</h1>
            <p>ç®¡ç†æ‚¨çš„æ‰€æœ‰è®¢å•</p>
        </div>

        <!-- ç­›é€‰å™¨ -->
        <!-- è®¢å•ç­›é€‰åŒºåŸŸï¼ŒåŒ…å«æŒ‰çŠ¶æ€ç­›é€‰å’ŒæŒ‰ç±»å‹ç­›é€‰ä¸¤ä¸ªç­›é€‰æ ‡ç­¾ç»„ -->
        <div class="filters">
            <!-- çŠ¶æ€ç­›é€‰æ ‡ç­¾ç»„ -->
            <div class="filter-tabs">
                <!-- å…¨éƒ¨çŠ¶æ€ç­›é€‰æŒ‰é’®ï¼ˆé»˜è®¤æ¿€æ´»ï¼‰ -->
                <button class="filter-tab active" onclick="filterByStatus(null, this)">å…¨éƒ¨</button>
                <!-- å¾…æ”¯ä»˜çŠ¶æ€ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByStatus(0, this)">å¾…æ”¯ä»˜</button>
                <!-- å·²æ”¯ä»˜çŠ¶æ€ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByStatus(1, this)">å·²æ”¯ä»˜</button>
                <!-- å·²å–æ¶ˆçŠ¶æ€ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByStatus(2, this)">å·²å–æ¶ˆ</button>
                <!-- å·²å®ŒæˆçŠ¶æ€ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByStatus(3, this)">å·²å®Œæˆ</button>
            </div>
            <!-- ç±»å‹ç­›é€‰æ ‡ç­¾ç»„ -->
            <div class="filter-tabs">
                <!-- æ‰€æœ‰ç±»å‹ç­›é€‰æŒ‰é’®ï¼ˆé»˜è®¤æ¿€æ´»ï¼‰ -->
                <button class="filter-tab active" onclick="filterByType(null, this)">æ‰€æœ‰ç±»å‹</button>
                <!-- ç¾é£Ÿå¤–å–ç±»å‹ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByType('FOOD', this)">ç¾é£Ÿå¤–å–</button>
                <!-- é…’åº—é¢„è®¢ç±»å‹ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByType('HOTEL', this)">é…’åº—é¢„è®¢</button>
                <!-- è´­ç‰©å•†åŸç±»å‹ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByType('SHOPPING', this)">è´­ç‰©å•†åŸ</button>
                <!-- æ™¯ç‚¹æ—…æ¸¸ç±»å‹ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByType('TRAVEL', this)">æ™¯ç‚¹æ—…æ¸¸</button>
                <!-- ç”Ÿæ´»ç¼´è´¹ç±»å‹ç­›é€‰æŒ‰é’® -->
                <button class="filter-tab" onclick="filterByType('PAYMENT', this)">ç”Ÿæ´»ç¼´è´¹</button>
            </div>
        </div>

        <!-- è®¢å•åˆ—è¡¨ -->
        <!-- è®¢å•åˆ—è¡¨å®¹å™¨ï¼Œè®¢å•å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        <div class="order-list">
            <!-- è®¢å•åˆ—è¡¨å®¹å™¨ï¼Œç”¨äºåŠ¨æ€æ’å…¥è®¢å•å¡ç‰‡ -->
            <div id="orderListContainer">
                <!-- åŠ è½½æç¤ºï¼ˆåˆå§‹æ˜¾ç¤ºï¼‰ -->
                <div class="loading">
                    <!-- åŠ è½½æç¤ºæ–‡æœ¬ -->
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 
        JavaScriptä»£ç å—
        åŠŸèƒ½æ¦‚è¿°ï¼šå®ç°è®¢å•ä¸­å¿ƒé¡µé¢çš„äº¤äº’åŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¢å•åˆ—è¡¨åŠ è½½ã€ç­›é€‰ã€è®¢å•æ“ä½œç­‰
    -->
    <script>
        /**
         * æ–‡ä»¶çº§æ³¨é‡Šï¼šç»Ÿä¸€è®¢å•ä¸­å¿ƒé¡µé¢JavaScriptåŠŸèƒ½æ¨¡å—
         * åŠŸèƒ½æ¦‚è¿°ï¼š
         *   1. è®¢å•åˆ—è¡¨åŠ è½½åŠŸèƒ½ï¼ˆä»åç«¯APIè·å–è®¢å•æ•°æ®ï¼‰
         *   2. è®¢å•ç­›é€‰åŠŸèƒ½ï¼ˆæŒ‰çŠ¶æ€ç­›é€‰ã€æŒ‰ç±»å‹ç­›é€‰ï¼‰
         *   3. è®¢å•æ¸²æŸ“åŠŸèƒ½ï¼ˆåŠ¨æ€ç”Ÿæˆè®¢å•å¡ç‰‡ï¼‰
         *   4. è®¢å•æ“ä½œåŠŸèƒ½ï¼ˆç»§ç»­æ”¯ä»˜ã€å–æ¶ˆè®¢å•ã€åˆ é™¤è®¢å•ã€æŸ¥çœ‹è¯¦æƒ…ï¼‰
         *   5. çŠ¶æ€å’Œç±»å‹è½¬æ¢åŠŸèƒ½ï¼ˆå°†çŠ¶æ€ç å’Œç±»å‹ç è½¬æ¢ä¸ºæ–‡æœ¬ï¼‰
         */
        
        // ==================== å…¨å±€å˜é‡ ====================
        /**
         * å½“å‰ç­›é€‰çš„çŠ¶æ€
         * åŠŸèƒ½æ¦‚è¿°ï¼šå­˜å‚¨å½“å‰é€‰ä¸­çš„è®¢å•çŠ¶æ€ç­›é€‰æ¡ä»¶ï¼ˆnullè¡¨ç¤ºå…¨éƒ¨ï¼Œ0è¡¨ç¤ºå¾…æ”¯ä»˜ï¼Œ1è¡¨ç¤ºå·²æ”¯ä»˜ï¼Œ2è¡¨ç¤ºå·²å–æ¶ˆï¼Œ3è¡¨ç¤ºå·²å®Œæˆï¼‰
         */
        // å½“å‰ç­›é€‰çš„çŠ¶æ€ï¼Œåˆå§‹å€¼ä¸ºnullï¼ˆè¡¨ç¤ºå…¨éƒ¨ï¼‰
        let currentStatus = null;
        /**
         * å½“å‰ç­›é€‰çš„ç±»å‹
         * åŠŸèƒ½æ¦‚è¿°ï¼šå­˜å‚¨å½“å‰é€‰ä¸­çš„è®¢å•ç±»å‹ç­›é€‰æ¡ä»¶ï¼ˆnullè¡¨ç¤ºå…¨éƒ¨ï¼Œ'FOOD'è¡¨ç¤ºç¾é£Ÿå¤–å–ï¼Œ'HOTEL'è¡¨ç¤ºé…’åº—é¢„è®¢ï¼Œ'SHOPPING'è¡¨ç¤ºè´­ç‰©å•†åŸï¼Œ'TRAVEL'è¡¨ç¤ºæ™¯ç‚¹æ—…æ¸¸ï¼Œ'PAYMENT'è¡¨ç¤ºç”Ÿæ´»ç¼´è´¹ï¼‰
         */
        // å½“å‰ç­›é€‰çš„ç±»å‹ï¼Œåˆå§‹å€¼ä¸ºnullï¼ˆè¡¨ç¤ºå…¨éƒ¨ï¼‰
        let currentType = null;

        // ==================== é¡µé¢åˆå§‹åŒ–åŠŸèƒ½æ¨¡å— ====================
        /**
         * é¡µé¢åŠ è½½æ—¶è·å–è®¢å•åˆ—è¡¨
         * åŠŸèƒ½æ¦‚è¿°ï¼šç›‘å¬DOMContentLoadedäº‹ä»¶ï¼Œå½“DOMåŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½è®¢å•åˆ—è¡¨
         */
        // ç›‘å¬DOMContentLoadedäº‹ä»¶ï¼Œå½“DOMåŠ è½½å®Œæˆåè§¦å‘
        document.addEventListener('DOMContentLoaded', () => {
            // è°ƒç”¨loadOrderså‡½æ•°ï¼ŒåŠ è½½è®¢å•åˆ—è¡¨
            loadOrders();
        });

        // ==================== è®¢å•åˆ—è¡¨åŠ è½½åŠŸèƒ½æ¨¡å— ====================
        /**
         * åŠ è½½è®¢å•åˆ—è¡¨
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶ï¼ˆçŠ¶æ€å’Œç±»å‹ï¼‰ï¼Œä»åç«¯APIè·å–è®¢å•åˆ—è¡¨æ•°æ®å¹¶æ¸²æŸ“
         */
        function loadOrders() {
            // è·å–è®¢å•åˆ—è¡¨å®¹å™¨å…ƒç´ 
            const container = document.getElementById('orderListContainer');
            // æ˜¾ç¤ºåŠ è½½æç¤º
            container.innerHTML = '<div class="loading"><div>åŠ è½½ä¸­...</div></div>';

            // æ„å»ºè¯·æ±‚URL
            // è®¢å•åˆ—è¡¨APIæ¥å£åœ°å€
            let url = '/unified-new/order/list';
            // åˆ›å»ºURLSearchParamså¯¹è±¡ï¼Œç”¨äºæ„å»ºæŸ¥è¯¢å‚æ•°
            const params = new URLSearchParams();
            // åˆ¤æ–­å½“å‰ç­›é€‰çš„çŠ¶æ€æ˜¯å¦ä¸ä¸ºnull
            if (currentStatus !== null) {
                // å¦‚æœå½“å‰ç­›é€‰çš„çŠ¶æ€ä¸ä¸ºnullï¼Œæ·»åŠ paymentStatuså‚æ•°
                params.append('paymentStatus', currentStatus);
            }
            // åˆ¤æ–­å½“å‰ç­›é€‰çš„ç±»å‹æ˜¯å¦ä¸ä¸ºnull
            if (currentType !== null) {
                // å¦‚æœå½“å‰ç­›é€‰çš„ç±»å‹ä¸ä¸ºnullï¼Œæ·»åŠ orderTypeå‚æ•°
                params.append('orderType', currentType);
            }
            // åˆ¤æ–­æ˜¯å¦æœ‰æŸ¥è¯¢å‚æ•°
            if (params.toString()) {
                // å¦‚æœæœ‰æŸ¥è¯¢å‚æ•°ï¼Œå°†æŸ¥è¯¢å‚æ•°è¿½åŠ åˆ°URLåé¢
                url += '?' + params.toString();
            }

            // ä½¿ç”¨fetch APIå‘é€GETè¯·æ±‚åˆ°åç«¯è®¢å•åˆ—è¡¨æ¥å£
            fetch(url, { credentials: 'include' })  // åŒ…å«Cookieï¼Œç”¨äºèº«ä»½éªŒè¯
                .then(response => response.json())  // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                .then(data => {
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸ
                    if (data.success) {
                        // å¦‚æœåŠ è½½æˆåŠŸï¼Œè°ƒç”¨renderOrderså‡½æ•°æ¸²æŸ“è®¢å•åˆ—è¡¨
                        renderOrders(data.data);
                    // å¦‚æœåŠ è½½å¤±è´¥
                    } else {
                        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                        container.innerHTML = `
                            <div class="error">
                                <div>åŠ è½½å¤±è´¥: ${data.message}</div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°
                    console.error('åŠ è½½è®¢å•å¤±è´¥:', error);
                    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    container.innerHTML = `
                        <div class="error">
                            <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                        </div>
                    `;
                });
        }

        // ==================== è®¢å•æ¸²æŸ“åŠŸèƒ½æ¨¡å— ====================
        /**
         * æ¸²æŸ“è®¢å•åˆ—è¡¨
         * åŠŸèƒ½æ¦‚è¿°ï¼šå°†è®¢å•æ•°æ®æ•°ç»„æ¸²æŸ“ä¸ºHTMLè®¢å•å¡ç‰‡åˆ—è¡¨
         * @param {Array} orders - è®¢å•æ•°æ®æ•°ç»„
         */
        function renderOrders(orders) {
            // è·å–è®¢å•åˆ—è¡¨å®¹å™¨å…ƒç´ 
            const container = document.getElementById('orderListContainer');
            
            // åˆ¤æ–­è®¢å•æ•°ç»„æ˜¯å¦ä¸ºç©º
            if (orders.length === 0) {
                // å¦‚æœè®¢å•æ•°ç»„ä¸ºç©ºï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <div class="empty-state-text">æš‚æ— è®¢å•</div>
                        <div class="empty-state-desc">æ‚¨è¿˜æ²¡æœ‰ä»»ä½•è®¢å•</div>
                    </div>
                `;
                // ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œ
                return;
            }

            // åˆå§‹åŒ–HTMLå­—ç¬¦ä¸²
            let html = '';
            // éå†è®¢å•æ•°ç»„ï¼Œä¸ºæ¯ä¸ªè®¢å•ç”ŸæˆHTMLå¡ç‰‡
            orders.forEach(order => {
                // è°ƒç”¨renderOrderCardå‡½æ•°ç”Ÿæˆè®¢å•å¡ç‰‡çš„HTMLï¼Œå¹¶è¿½åŠ åˆ°htmlå­—ç¬¦ä¸²ä¸­
                html += renderOrderCard(order);
            });
            // å°†ç”Ÿæˆçš„HTMLè®¾ç½®åˆ°å®¹å™¨ä¸­
            container.innerHTML = html;
        }

        /**
         * æ¸²æŸ“è®¢å•å¡ç‰‡
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•æ•°æ®ç”Ÿæˆè®¢å•å¡ç‰‡çš„HTMLå­—ç¬¦ä¸²
         * @param {Object} order - è®¢å•æ•°æ®å¯¹è±¡ï¼ŒåŒ…å«orderNoã€paymentStatusã€orderTypeã€orderTitleã€orderDescriptionã€totalAmountã€createTimeç­‰å±æ€§
         * @return {String} è®¢å•å¡ç‰‡çš„HTMLå­—ç¬¦ä¸²
         */
        function renderOrderCard(order) {
            // è·å–è®¢å•çŠ¶æ€çš„æ ·å¼ç±»å
            const statusClass = getStatusClass(order.paymentStatus);
            // è·å–è®¢å•çŠ¶æ€çš„æ–‡æœ¬
            const statusText = getStatusText(order.paymentStatus);
            // è·å–è®¢å•ç±»å‹çš„æ–‡æœ¬
            const typeText = getTypeText(order.orderType);
            // æ ¼å¼åŒ–åˆ›å»ºæ—¶é—´ï¼ˆè½¬æ¢ä¸ºä¸­æ–‡æœ¬åœ°åŒ–æ ¼å¼ï¼‰
            const createTime = new Date(order.createTime).toLocaleString('zh-CN');
            
            // æ ¼å¼åŒ–é‡‘é¢ï¼ˆå¤„ç† null å€¼ï¼‰
            // åˆ¤æ–­è®¢å•æ€»é‡‘é¢æ˜¯å¦ä¸ä¸ºnullï¼Œå¦‚æœä¸ä¸ºnullåˆ™æ ¼å¼åŒ–ä¸ºä¸¤ä½å°æ•°ï¼Œå¦åˆ™ä½¿ç”¨'0.00'
            const totalAmount = order.totalAmount != null ? parseFloat(order.totalAmount).toFixed(2) : '0.00';

            // æ ¹æ®è®¢å•çŠ¶æ€ç”Ÿæˆæ“ä½œæŒ‰é’®
            // åˆå§‹åŒ–æ“ä½œæŒ‰é’®HTMLå­—ç¬¦ä¸²
            let actions = '';
            // åˆ¤æ–­è®¢å•æ”¯ä»˜çŠ¶æ€æ˜¯å¦ä¸º0ï¼ˆå¾…æ”¯ä»˜ï¼‰
            if (order.paymentStatus === 0) {
                // å¦‚æœè®¢å•çŠ¶æ€ä¸ºå¾…æ”¯ä»˜ï¼Œæ˜¾ç¤º"ç»§ç»­æ”¯ä»˜"å’Œ"å–æ¶ˆè®¢å•"æŒ‰é’®
                actions = `
                    <button class="btn btn-primary" onclick="continuePayment('${order.orderNo}')">ç»§ç»­æ”¯ä»˜</button>
                    <button class="btn btn-danger" onclick="cancelOrder('${order.orderNo}')">å–æ¶ˆè®¢å•</button>
                `;
            // åˆ¤æ–­è®¢å•æ”¯ä»˜çŠ¶æ€æ˜¯å¦ä¸º2ï¼ˆå·²å–æ¶ˆï¼‰
            } else if (order.paymentStatus === 2) {
                // å¦‚æœè®¢å•çŠ¶æ€ä¸ºå·²å–æ¶ˆï¼Œæ˜¾ç¤º"åˆ é™¤è®¢å•"æŒ‰é’®
                actions = `
                    <button class="btn btn-outline" onclick="deleteOrder('${order.orderNo}')">åˆ é™¤è®¢å•</button>
                `;
            // å…¶ä»–çŠ¶æ€ï¼ˆå·²æ”¯ä»˜ã€å·²å®Œæˆï¼‰
            } else {
                // å¦‚æœè®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜æˆ–å·²å®Œæˆï¼Œæ˜¾ç¤º"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®
                actions = `
                    <button class="btn btn-outline" onclick="viewDetail('${order.orderNo}')">æŸ¥çœ‹è¯¦æƒ…</button>
                `;
            }

            // è¿”å›è®¢å•å¡ç‰‡çš„HTMLå­—ç¬¦ä¸²
            return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-number">è®¢å•å·: ${order.orderNo}</div>
                        <div class="order-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="order-body">
                        <div class="order-info">
                            <div class="order-type">${typeText}</div>
                            <div class="order-title">${order.orderTitle || 'è®¢å•'}</div>
                            <div class="order-description">${order.orderDescription || ''}</div>
                        </div>
                        <div class="order-amount">Â¥${totalAmount}</div>
                    </div>
                    <div class="order-footer">
                        <div class="order-time">${createTime}</div>
                        <div class="order-actions">
                            ${actions}
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== çŠ¶æ€å’Œç±»å‹è½¬æ¢åŠŸèƒ½æ¨¡å— ====================
        /**
         * è·å–çŠ¶æ€æ ·å¼ç±»
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•æ”¯ä»˜çŠ¶æ€ç è¿”å›å¯¹åº”çš„CSSæ ·å¼ç±»å
         * @param {Number} status - è®¢å•æ”¯ä»˜çŠ¶æ€ç ï¼ˆ0è¡¨ç¤ºå¾…æ”¯ä»˜ï¼Œ1è¡¨ç¤ºå·²æ”¯ä»˜ï¼Œ2è¡¨ç¤ºå·²å–æ¶ˆï¼Œ3è¡¨ç¤ºå·²å®Œæˆï¼‰
         * @return {String} çŠ¶æ€æ ·å¼ç±»å
         */
        function getStatusClass(status) {
            // ä½¿ç”¨switchè¯­å¥æ ¹æ®çŠ¶æ€ç è¿”å›å¯¹åº”çš„æ ·å¼ç±»å
            switch (status) {
                case 0: return 'status-unpaid';  // å¾…æ”¯ä»˜æ ·å¼ç±»
                case 1: return 'status-paid';  // å·²æ”¯ä»˜æ ·å¼ç±»
                case 2: return 'status-cancelled';  // å·²å–æ¶ˆæ ·å¼ç±»
                case 3: return 'status-completed';  // å·²å®Œæˆæ ·å¼ç±»
                default: return 'status-unpaid';  // é»˜è®¤è¿”å›å¾…æ”¯ä»˜æ ·å¼ç±»
            }
        }

        /**
         * è·å–çŠ¶æ€æ–‡æœ¬
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•æ”¯ä»˜çŠ¶æ€ç è¿”å›å¯¹åº”çš„çŠ¶æ€æ–‡æœ¬
         * @param {Number} status - è®¢å•æ”¯ä»˜çŠ¶æ€ç ï¼ˆ0è¡¨ç¤ºå¾…æ”¯ä»˜ï¼Œ1è¡¨ç¤ºå·²æ”¯ä»˜ï¼Œ2è¡¨ç¤ºå·²å–æ¶ˆï¼Œ3è¡¨ç¤ºå·²å®Œæˆï¼‰
         * @return {String} çŠ¶æ€æ–‡æœ¬
         */
        function getStatusText(status) {
            // ä½¿ç”¨switchè¯­å¥æ ¹æ®çŠ¶æ€ç è¿”å›å¯¹åº”çš„çŠ¶æ€æ–‡æœ¬
            switch (status) {
                case 0: return 'å¾…æ”¯ä»˜';  // å¾…æ”¯ä»˜æ–‡æœ¬
                case 1: return 'å·²æ”¯ä»˜';  // å·²æ”¯ä»˜æ–‡æœ¬
                case 2: return 'å·²å–æ¶ˆ';  // å·²å–æ¶ˆæ–‡æœ¬
                case 3: return 'å·²å®Œæˆ';  // å·²å®Œæˆæ–‡æœ¬
                default: return 'æœªçŸ¥çŠ¶æ€';  // é»˜è®¤è¿”å›æœªçŸ¥çŠ¶æ€æ–‡æœ¬
            }
        }

        /**
         * è·å–ç±»å‹æ–‡æœ¬
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•ç±»å‹ç è¿”å›å¯¹åº”çš„ç±»å‹æ–‡æœ¬
         * @param {String} type - è®¢å•ç±»å‹ç ï¼ˆ'FOOD'è¡¨ç¤ºç¾é£Ÿå¤–å–ï¼Œ'HOTEL'è¡¨ç¤ºé…’åº—é¢„è®¢ï¼Œ'SHOPPING'è¡¨ç¤ºè´­ç‰©å•†åŸï¼Œ'TRAVEL'è¡¨ç¤ºæ™¯ç‚¹æ—…æ¸¸ï¼Œ'PAYMENT'è¡¨ç¤ºç”Ÿæ´»ç¼´è´¹ï¼‰
         * @return {String} ç±»å‹æ–‡æœ¬
         */
        function getTypeText(type) {
            // ä½¿ç”¨switchè¯­å¥æ ¹æ®ç±»å‹ç è¿”å›å¯¹åº”çš„ç±»å‹æ–‡æœ¬
            switch (type) {
                case 'FOOD': return 'ç¾é£Ÿå¤–å–';  // ç¾é£Ÿå¤–å–æ–‡æœ¬
                case 'HOTEL': return 'é…’åº—é¢„è®¢';  // é…’åº—é¢„è®¢æ–‡æœ¬
                case 'SHOPPING': return 'è´­ç‰©å•†åŸ';  // è´­ç‰©å•†åŸæ–‡æœ¬
                case 'TRAVEL': return 'æ™¯ç‚¹æ—…æ¸¸';  // æ™¯ç‚¹æ—…æ¸¸æ–‡æœ¬
                case 'PAYMENT': return 'ç”Ÿæ´»ç¼´è´¹';  // ç”Ÿæ´»ç¼´è´¹æ–‡æœ¬
                default: return 'æœªçŸ¥ç±»å‹';  // é»˜è®¤è¿”å›æœªçŸ¥ç±»å‹æ–‡æœ¬
            }
        }

        // ==================== è®¢å•ç­›é€‰åŠŸèƒ½æ¨¡å— ====================
        /**
         * æŒ‰çŠ¶æ€ç­›é€‰
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•æ”¯ä»˜çŠ¶æ€ç­›é€‰è®¢å•åˆ—è¡¨
         * @param {Number|null} status - è®¢å•æ”¯ä»˜çŠ¶æ€ç ï¼ˆnullè¡¨ç¤ºå…¨éƒ¨ï¼Œ0è¡¨ç¤ºå¾…æ”¯ä»˜ï¼Œ1è¡¨ç¤ºå·²æ”¯ä»˜ï¼Œ2è¡¨ç¤ºå·²å–æ¶ˆï¼Œ3è¡¨ç¤ºå·²å®Œæˆï¼‰
         * @param {HTMLElement} element - è§¦å‘ç­›é€‰çš„æŒ‰é’®å…ƒç´ 
         */
        function filterByStatus(status, element) {
            // æ›´æ–°å½“å‰ç­›é€‰çš„çŠ¶æ€
            currentStatus = status;
            // æ›´æ–°çŠ¶æ€ç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            updateFilterTabs('.filter-tabs:first-child .filter-tab', element);
            // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨
            loadOrders();
        }

        /**
         * æŒ‰ç±»å‹ç­›é€‰
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ ¹æ®è®¢å•ç±»å‹ç­›é€‰è®¢å•åˆ—è¡¨
         * @param {String|null} type - è®¢å•ç±»å‹ç ï¼ˆnullè¡¨ç¤ºå…¨éƒ¨ï¼Œ'FOOD'è¡¨ç¤ºç¾é£Ÿå¤–å–ï¼Œ'HOTEL'è¡¨ç¤ºé…’åº—é¢„è®¢ï¼Œ'SHOPPING'è¡¨ç¤ºè´­ç‰©å•†åŸï¼Œ'TRAVEL'è¡¨ç¤ºæ™¯ç‚¹æ—…æ¸¸ï¼Œ'PAYMENT'è¡¨ç¤ºç”Ÿæ´»ç¼´è´¹ï¼‰
         * @param {HTMLElement} element - è§¦å‘ç­›é€‰çš„æŒ‰é’®å…ƒç´ 
         */
        function filterByType(type, element) {
            // æ›´æ–°å½“å‰ç­›é€‰çš„ç±»å‹
            currentType = type;
            // æ›´æ–°ç±»å‹ç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            updateFilterTabs('.filter-tabs:last-child .filter-tab', element);
            // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨
            loadOrders();
        }

        /**
         * æ›´æ–°ç­›é€‰æ ‡ç­¾çŠ¶æ€
         * åŠŸèƒ½æ¦‚è¿°ï¼šæ›´æ–°ç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€ï¼Œç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»ï¼Œä¸ºå½“å‰é€‰ä¸­çš„æ ‡ç­¾æ·»åŠ activeç±»
         * @param {String} selector - ç­›é€‰æ ‡ç­¾çš„é€‰æ‹©å™¨
         * @param {HTMLElement} activeElement - å½“å‰é€‰ä¸­çš„æ ‡ç­¾å…ƒç´ 
         */
        function updateFilterTabs(selector, activeElement) {
            // éå†æ‰€æœ‰ç­›é€‰æ ‡ç­¾ï¼Œç§»é™¤activeç±»ï¼Œå–æ¶ˆæ¿€æ´»çŠ¶æ€
            document.querySelectorAll(selector).forEach(tab => {
                tab.classList.remove('active');
            });
            // ä¸ºå½“å‰é€‰ä¸­çš„æ ‡ç­¾æ·»åŠ activeç±»ï¼Œæ¿€æ´»é€‰ä¸­çŠ¶æ€
            activeElement.classList.add('active');
        }

        // ==================== è®¢å•æ“ä½œåŠŸèƒ½æ¨¡å— ====================
        /**
         * ç»§ç»­æ”¯ä»˜
         * åŠŸèƒ½æ¦‚è¿°ï¼šè·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼Œç»§ç»­æ”¯ä»˜å¾…æ”¯ä»˜çš„è®¢å•
         * @param {String} orderNo - è®¢å•å·
         */
        function continuePayment(orderNo) {
            // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼Œä¼ é€’è®¢å•å·å‚æ•°
            window.location.href = `/unified-new/payment/checkout?orderNo=${orderNo}`;
        }

        /**
         * å–æ¶ˆè®¢å•
         * åŠŸèƒ½æ¦‚è¿°ï¼šå–æ¶ˆå¾…æ”¯ä»˜çš„è®¢å•ï¼Œå‘é€å–æ¶ˆè¯·æ±‚åˆ°åç«¯
         * @param {String} orderNo - è®¢å•å·
         */
        function cancelOrder(orderNo) {
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šå–æ¶ˆè®¢å•
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                // å¦‚æœç”¨æˆ·ç¡®è®¤ï¼Œä½¿ç”¨fetch APIå‘é€POSTè¯·æ±‚åˆ°åç«¯å–æ¶ˆè®¢å•æ¥å£
                fetch('/unified-new/order/cancel', {
                    method: 'POST',  // è¯·æ±‚æ–¹æ³•ä¸ºPOST
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'  // è®¾ç½®è¯·æ±‚å¤´ï¼ŒæŒ‡å®šå†…å®¹ç±»å‹ä¸ºè¡¨å•æ•°æ®
                    },
                    body: `orderNo=${orderNo}`,  // å°†è®¢å•å·ç¼–ç åä½œä¸ºè¯·æ±‚ä½“
                    credentials: 'include'  // åŒ…å«Cookieï¼Œç”¨äºèº«ä»½éªŒè¯
                })
                .then(response => response.json())  // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                .then(data => {
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸ
                    if (data.success) {
                        // å¦‚æœå–æ¶ˆæˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        alert('è®¢å•å·²å–æ¶ˆ');
                        // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨
                        loadOrders();
                    // å¦‚æœå–æ¶ˆå¤±è´¥
                    } else {
                        // æ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯
                        alert('å–æ¶ˆå¤±è´¥: ' + data.message);
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    alert('å–æ¶ˆå¤±è´¥: ' + error.message);
                });
            }
        }

        /**
         * åˆ é™¤è®¢å•
         * åŠŸèƒ½æ¦‚è¿°ï¼šåˆ é™¤å·²å–æ¶ˆçš„è®¢å•ï¼Œå‘é€åˆ é™¤è¯·æ±‚åˆ°åç«¯
         * @param {String} orderNo - è®¢å•å·
         */
        function deleteOrder(orderNo) {
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šåˆ é™¤è®¢å•ï¼ˆåˆ é™¤åæ— æ³•æ¢å¤ï¼‰
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) {
                // å¦‚æœç”¨æˆ·ç¡®è®¤ï¼Œä½¿ç”¨fetch APIå‘é€POSTè¯·æ±‚åˆ°åç«¯åˆ é™¤è®¢å•æ¥å£
                fetch('/unified-new/order/delete', {
                    method: 'POST',  // è¯·æ±‚æ–¹æ³•ä¸ºPOST
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'  // è®¾ç½®è¯·æ±‚å¤´ï¼ŒæŒ‡å®šå†…å®¹ç±»å‹ä¸ºè¡¨å•æ•°æ®
                    },
                    body: `orderNo=${orderNo}`,  // å°†è®¢å•å·ç¼–ç åä½œä¸ºè¯·æ±‚ä½“
                    credentials: 'include'  // åŒ…å«Cookieï¼Œç”¨äºèº«ä»½éªŒè¯
                })
                .then(response => response.json())  // å°†å“åº”è½¬æ¢ä¸ºJSONå¯¹è±¡
                .then(data => {
                    // åˆ¤æ–­åç«¯æ˜¯å¦è¿”å›æˆåŠŸ
                    if (data.success) {
                        // å¦‚æœåˆ é™¤æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        alert('è®¢å•å·²åˆ é™¤');
                        // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨
                        loadOrders();
                    // å¦‚æœåˆ é™¤å¤±è´¥
                    } else {
                        // æ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯
                        alert('åˆ é™¤å¤±è´¥: ' + data.message);
                    }
                })
                .catch(error => {
                    // å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    alert('åˆ é™¤å¤±è´¥: ' + error.message);
                });
            }
        }

        /**
         * æŸ¥çœ‹è¯¦æƒ…
         * åŠŸèƒ½æ¦‚è¿°ï¼šè·³è½¬åˆ°æ”¯ä»˜é¡µé¢æŸ¥çœ‹è®¢å•è¯¦æƒ…ï¼ˆå·²æ”¯ä»˜çš„è®¢å•ä¹Ÿå¯ä»¥æŸ¥çœ‹ï¼‰
         * @param {String} orderNo - è®¢å•å·
         */
        function viewDetail(orderNo) {
            // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢æŸ¥çœ‹è¯¦æƒ…ï¼ˆå·²æ”¯ä»˜çš„è®¢å•ä¹Ÿå¯ä»¥æŸ¥çœ‹ï¼‰
            // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼Œä¼ é€’è®¢å•å·å‚æ•°
            window.location.href = `/unified-new/payment/checkout?orderNo=${orderNo}`;
        }
    </script>
</body>
</html>
