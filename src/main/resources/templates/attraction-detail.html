<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™¯ç‚¹è¯¦æƒ… - æ¸¸å¸‚ç”Ÿæ´»</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/navbar.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #667eea;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #00CED1, #48D1CC);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 206, 209, 0.3);
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #20B2AA, #00CED1);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 206, 209, 0.4);
        }

        .detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            padding-top: 110px;
        }

        .attraction-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
            position: relative;
        }

        .header-image {
            width: 100%;
            height: 400px;
            position: relative;
            overflow: hidden;
        }

        .header-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 40px;
            color: white;
        }

        .attraction-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .attraction-location {
            font-size: 18px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .action-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            backdrop-filter: blur(10px);
        }

        .action-btn:hover {
            background: rgba(0, 206, 209, 0.8);
            transform: scale(1.1);
        }

        .action-btn.favorited {
            background: rgba(220, 53, 69, 0.8);
        }

        .detail-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: #00CED1;
            font-size: 24px;
        }

        .description {
            color: #666;
            line-height: 1.8;
            font-size: 16px;
            text-indent: 2em;
            margin-bottom: 25px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .feature-tag {
            background: linear-gradient(135deg, #00CED1, #48D1CC);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0, 206, 209, 0.3);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .feature-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 206, 209, 0.4);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-value {
            color: #666;
            font-weight: 500;
        }

        .price-highlight {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #ffd700;
            font-size: 16px;
        }

        .tips-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border-left: 4px solid #00CED1;
        }

        .tips-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-content {
            color: #666;
            line-height: 1.6;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 18px;
        }

        .loading i {
            font-size: 48px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 18px;
        }

        .error-message i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        @media (max-width: 768px) {
            .detail-content {
                grid-template-columns: 1fr;
            }

            .attraction-title {
                font-size: 28px;
            }

            .header-stats {
                flex-wrap: wrap;
                gap: 10px;
            }

            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .main-content, .info-card {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
    <header class="header">
        <nav class="nav">
            <a href="/" class="logo">
                <i class="fas fa-city"></i>
                æ¸¸å¸‚ç”Ÿæ´»
            </a>
            <ul class="nav-links">
                <li><a href="/">é¦–é¡µ</a></li>
                <li><a href="/hc/f2">ä½å®¿æœåŠ¡</a></li>
                <li><a href="/travel">å‡ºè¡ŒæœåŠ¡</a></li>
                <li><a href="/food">ç¾é£ŸæœåŠ¡</a></li>
                <li><a href="/shopping">è´­ç‰©æœåŠ¡</a></li>
                <li><a href="/payment">ç”Ÿæ´»ç¼´è´¹</a></li>
            </ul>
            <div class="user-actions">
                <div th:if="${session.user == null}">
                    <a href="/user/login" class="login-btn">ç™»å½•</a>
                    <a href="/user/register" class="register-btn">æ³¨å†Œ</a>
                </div>
                <div th:if="${session.user != null}">
                    <a href="/unified-new/orders" style="color: #FF6600; text-decoration: none; font-weight: 500; margin-right: 15px;">
                        <i class="fas fa-list-alt"></i>
                        æˆ‘çš„è®¢å•
                    </a>
                    <a href="/user/profile" style="color: #FF6600; text-decoration: none; font-weight: 500;">
                        <i class="fas fa-user-circle"></i>
                        <span th:text="${session.user.nickname ?: session.user.username}">ç”¨æˆ·</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="detail-container">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="loading">
            <i class="fas fa-spinner"></i>
            <div>æ­£åœ¨åŠ è½½æ™¯ç‚¹è¯¦æƒ…...</div>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <div>åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>
        </div>

        <!-- æ™¯ç‚¹è¯¦æƒ…å†…å®¹ -->
        <div id="attraction-detail" style="display: none;">
            <!-- å¤´éƒ¨åŒºåŸŸ -->
            <div class="attraction-header">
                <div class="header-image">
                    <img id="main-image" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&w=800&h=600&fit=crop" alt="æ™¯ç‚¹å›¾ç‰‡" onerror="handleImageError(this)">
                    <div class="image-overlay">
                        <h1 class="attraction-title" id="attraction-name">æ™¯ç‚¹åç§°</h1>
                        <div class="attraction-location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="attraction-location">ä½ç½®ä¿¡æ¯</span>
                        </div>
                        <div class="header-stats">
                            <div class="stat-item">
                                <i class="fas fa-star"></i>
                                <span id="attraction-rating">4.5</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-eye"></i>
                                <span id="view-count">1000</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span id="like-count">100</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="action-buttons">
                    <button class="action-btn" id="favorite-btn" onclick="toggleFavorite()">
                        <i class="far fa-heart"></i>
                    </button>
                    <button class="action-btn" onclick="shareAttraction()">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </div>

            <!-- è¯¦æƒ…å†…å®¹ -->
            <div class="detail-content">
                <!-- ä¸»è¦å†…å®¹ -->
                <div class="main-content">
                    <div class="card-title">
                        <i class="fas fa-info-circle"></i>
                        æ™¯ç‚¹ä»‹ç»
                    </div>
                    <div class="description" id="attraction-description">
                        æ™¯ç‚¹è¯¦ç»†ä»‹ç»å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                    </div>
                    
                    <div class="card-title">
                        <i class="fas fa-tags"></i>
                        æ™¯ç‚¹ç‰¹è‰²
                    </div>
                    <div class="features-grid" id="features-container">
                        <!-- ç‰¹è‰²æ ‡ç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="tips-section" id="tips-section" style="display: none;">
                        <div class="tips-title">
                            <i class="fas fa-lightbulb"></i>
                            æ¸¸ç©å°è´´å£«
                        </div>
                        <div class="tips-content" id="tips-content">
                            <!-- å°è´´å£«å†…å®¹ -->
                        </div>
                    </div>
                </div>

                <!-- ä¾§è¾¹æ  -->
                <div class="sidebar">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="info-card">
                        <div class="card-title">
                            <i class="fas fa-clipboard-list"></i>
                            åŸºæœ¬ä¿¡æ¯
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <i class="fas fa-money-bill-wave"></i>
                                é—¨ç¥¨ä»·æ ¼
                            </div>
                            <div class="info-value">
                                <span class="price-highlight" id="price-range">å…è´¹</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <i class="fas fa-clock"></i>
                                å¼€æ”¾æ—¶é—´
                            </div>
                            <div class="info-value" id="opening-hours">å…¨å¤©å¼€æ”¾</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <i class="fas fa-star"></i>
                                è¯„åˆ†
                            </div>
                            <div class="info-value">
                                <div class="rating-display">
                                    <div class="stars" id="rating-stars">
                                        <!-- æ˜Ÿæ˜Ÿå°†åŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                    <span id="rating-text">4.5</span>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <i class="fas fa-users"></i>
                                çƒ­åº¦
                            </div>
                            <div class="info-value" id="popularity">çƒ­é—¨æ™¯ç‚¹</div>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="info-card">
                        <div class="card-title">
                            <i class="fas fa-tools"></i>
                            å¿«é€Ÿæ“ä½œ
                        </div>
                        <button class="feature-tag" onclick="addToFavorites()" style="width: 100%; margin-bottom: 10px;">
                            <i class="fas fa-heart"></i> åŠ å…¥æ”¶è—
                        </button>
                        <button class="feature-tag" onclick="shareAttraction()" style="width: 100%; margin-bottom: 10px;">
                            <i class="fas fa-share"></i> åˆ†äº«æ™¯ç‚¹
                        </button>
                        <button class="feature-tag" onclick="reportIssue()" style="width: 100%;">
                            <i class="fas fa-flag"></i> åé¦ˆé—®é¢˜
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== 43å¼ ç¾ä¸½æ™¯ç‚¹å›¾ç‰‡URLæ•°ç»„ =====
        const defaultAttractionImages = [
            // è‡ªç„¶é£å…‰ç±»
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å±±å³°
            'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ£®æ—
            'https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ¹–æ³Š
            'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·å²¸
            'https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç€‘å¸ƒ
            'https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // é›ªå±±
            'https://images.unsplash.com/photo-1501436513145-30f24e19fcc4?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ²™æ¼ 
            'https://images.unsplash.com/photo-1464822759844-d150f84ad8de?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å³¡è°·
            'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·æ»©
            'https://images.unsplash.com/photo-1439066615861-d1af74d74000?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ—¥å‡º
            
            // å¤å»ºç­‘æ–‡åŒ–ç±»
            'https://images.unsplash.com/photo-1508804185872-d7badad00f7d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤å¯ºåº™
            'https://images.unsplash.com/photo-1471919743851-c4df8b6ee133?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤åŸå¢™
            'https://images.unsplash.com/photo-1545558014-8692077e9b5c?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å®«æ®¿
            'https://images.unsplash.com/photo-1513415825881-57c6b43bf862?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤å¡”
            'https://images.unsplash.com/photo-1559717201-fbb671ff56b7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ä¼ ç»Ÿå»ºç­‘
            'https://images.unsplash.com/photo-1518709268805-4e9042af2ac0?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ¡¥
            'https://images.unsplash.com/photo-1574608851747-15d28b7e3d69?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å›­æ—
            'https://images.unsplash.com/photo-1565967511849-76a60a516170?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // äº­å°æ¥¼é˜
            'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ‘è½
            'https://images.unsplash.com/photo-1609948668013-b5e7f3088607?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ•…å®«
            
            // ç°ä»£æ™¯è§‚ç±»
            'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç°ä»£å»ºç­‘
            'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1f?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ‘©å¤©å¤§æ¥¼
            'https://images.unsplash.com/photo-1514924013411-cbf25faa35bb?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // åŸå¸‚å¤œæ™¯
            'https://images.unsplash.com/photo-1549924231-f129b911e442?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å…¬å›­
            'https://images.unsplash.com/photo-1533587851505-d119e13fa0d7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¹¿åœº
            'https://images.unsplash.com/photo-1529655683826-3c6b7ded86b6?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // åšç‰©é¦†
            'https://images.unsplash.com/photo-1429734956993-8a9b0555e122?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // è‰ºæœ¯é¦†
            'https://images.unsplash.com/photo-1494949649109-ecfc3b8c35df?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç§‘æŠ€é¦†
            'https://images.unsplash.com/photo-1518135714426-c18f5ffb6f4d?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // è§‚æ™¯å°
            'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ä¸»é¢˜å…¬å›­
            
            // ç‰¹è‰²æ™¯ç‚¹ç±»
            'https://images.unsplash.com/photo-1464278533981-50106e6176b1?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç«¹æ—
            'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // èŒ¶å›­
            'https://images.unsplash.com/photo-1548013146-72479768bada?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // èŠ±ç”°
            'https://images.unsplash.com/photo-1490730141103-6cac27aaab94?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç”°å›­é£å…‰
            'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤é•‡
            'https://images.unsplash.com/photo-1586511925558-a4c6376fe65f?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ±Ÿå—æ°´ä¹¡
            'https://images.unsplash.com/photo-1571804499305-1dfe4c7e5d63?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ°‘ä¿—æ‘
            'https://images.unsplash.com/photo-1555400113-8a2d1c19f1e1?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ¸©æ³‰
            'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æµ·å²›
            'https://images.unsplash.com/photo-1537225228614-56cc3556d7ed?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æº¶æ´
            
            // å­£èŠ‚ç‰¹è‰²ç±»
            'https://images.unsplash.com/photo-1509773896068-7fd415d91e2e?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // æ˜¥èŠ±
            'https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // å¤æ—¥æµ·æ»¨
            'https://images.unsplash.com/photo-1507608869274-d3177c8bb4c7?ixlib=rb-4.0.3&w=800&h=600&fit=crop', // ç§‹å¶
            'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&w=800&h=600&fit=crop'  // å†¬é›ª
        ];

        // è·å–éšæœºé»˜è®¤å›¾ç‰‡
        function getRandomDefaultImage() {
            const randomIndex = Math.floor(Math.random() * defaultAttractionImages.length);
            return defaultAttractionImages[randomIndex];
        }

        // å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
        function handleImageError(imgElement) {
            console.log('âš ï¸ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨éšæœºé»˜è®¤å›¾ç‰‡');
            imgElement.src = getRandomDefaultImage();
            // é˜²æ­¢æ— é™å¾ªç¯ï¼Œç»™å›¾ç‰‡æ·»åŠ æ ‡è®°
            imgElement.onerror = function() {
                console.log('âš ï¸ é»˜è®¤å›¾ç‰‡ä¹ŸåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å¤‡ç”¨å›¾ç‰‡');
                this.src = '/img/1.jpg';
                this.onerror = null; // é˜²æ­¢æ— é™å¾ªç¯
            };
        }

        // localStorage æ•°æ®ç®¡ç†å™¨
        class UserDataManager {
            constructor() {
                this.storageKeys = {
                    browsingHistory: 'xihu_browsing_history',
                    favoriteAttractions: 'xihu_favorite_attractions'
                };
            }

            saveBrowsingHistory(attractionName, attractionData) {
                try {
                    let history = this.getBrowsingHistory();
                    history = history.filter(item => item.name !== attractionName);
                    
                    const historyItem = {
                        name: attractionName,
                        data: attractionData,
                        timestamp: Date.now(),
                        date: new Date().toLocaleDateString('zh-CN')
                    };
                    
                    history.unshift(historyItem);
                    if (history.length > 50) {
                        history = history.slice(0, 50);
                    }
                    
                    localStorage.setItem(this.storageKeys.browsingHistory, JSON.stringify(history));
                    console.log('âœ… æµè§ˆå†å²å·²ä¿å­˜:', attractionName);
                } catch (error) {
                    console.error('âŒ ä¿å­˜æµè§ˆå†å²å¤±è´¥:', error);
                }
            }

            getBrowsingHistory() {
                try {
                    const data = localStorage.getItem(this.storageKeys.browsingHistory);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('âŒ è·å–æµè§ˆå†å²å¤±è´¥:', error);
                    return [];
                }
            }

            toggleFavorite(attractionName, attractionData) {
                try {
                    let favorites = this.getFavorites();
                    const index = favorites.findIndex(item => item.name === attractionName);
                    
                    if (index > -1) {
                        favorites.splice(index, 1);
                        localStorage.setItem(this.storageKeys.favoriteAttractions, JSON.stringify(favorites));
                        console.log('ğŸ’” å·²å–æ¶ˆæ”¶è—:', attractionName);
                        return false;
                    } else {
                        favorites.unshift({
                            name: attractionName,
                            data: attractionData,
                            timestamp: Date.now(),
                            date: new Date().toLocaleDateString('zh-CN')
                        });
                        localStorage.setItem(this.storageKeys.favoriteAttractions, JSON.stringify(favorites));
                        console.log('â¤ï¸ å·²æ·»åŠ æ”¶è—:', attractionName);
                        return true;
                    }
                } catch (error) {
                    console.error('âŒ æ“ä½œæ”¶è—å¤±è´¥:', error);
                    return false;
                }
            }

            getFavorites() {
                try {
                    const data = localStorage.getItem(this.storageKeys.favoriteAttractions);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('âŒ è·å–æ”¶è—åˆ—è¡¨å¤±è´¥:', error);
                    return [];
                }
            }

            isFavorite(attractionName) {
                const favorites = this.getFavorites();
                return favorites.some(item => item.name === attractionName);
            }
        }

        // åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
        const userDataManager = new UserDataManager();
        let currentAttraction = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å…ˆè®¾ç½®ä¸€ä¸ªé»˜è®¤å›¾ç‰‡
            const mainImage = document.getElementById('main-image');
            mainImage.src = getRandomDefaultImage();
            console.log('ğŸ–¼ï¸ é¡µé¢åˆå§‹åŒ–ï¼Œè®¾ç½®é»˜è®¤å›¾ç‰‡');
            
            loadAttractionDetail();
        });

        // åŠ è½½æ™¯ç‚¹è¯¦æƒ…
        function loadAttractionDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const attractionName = urlParams.get('name');
            const attractionId = urlParams.get('id');
            const tempKey = urlParams.get('tempKey');

            console.log('ğŸ” å¼€å§‹åŠ è½½æ™¯ç‚¹è¯¦æƒ…');
            console.log('ğŸ“‹ URLå‚æ•° - name:', attractionName, 'id:', attractionId, 'tempKey:', tempKey);

            if (!attractionName && !attractionId) {
                showError('ç¼ºå°‘æ™¯ç‚¹ä¿¡æ¯å‚æ•°');
                return;
            }

            showLoading();

            // ä¼˜å…ˆå°è¯•ä»ä¸´æ—¶localStorageè·å–æ•°æ®
            if (tempKey) {
                try {
                    const tempData = localStorage.getItem(tempKey);
                    if (tempData) {
                        const attraction = JSON.parse(tempData);
                        console.log('âœ… ä»ä¸´æ—¶localStorageè·å–åˆ°æ™¯ç‚¹æ•°æ®:', attraction);
                        
                        currentAttraction = attraction;
                        displayAttractionDetail(attraction);
                        
                        // ä¿å­˜æµè§ˆå†å²
                        userDataManager.saveBrowsingHistory(
                            attraction.name || attraction.title || attractionName,
                            attraction
                        );
                        
                        // æ¸…ç†ä¸´æ—¶æ•°æ®
                        setTimeout(() => {
                            localStorage.removeItem(tempKey);
                            console.log('ğŸ§¹ å·²æ¸…ç†ä¸´æ—¶æ•°æ®');
                        }, 1000);
                        
                        return;
                    }
                } catch (error) {
                    console.warn('âš ï¸ è·å–ä¸´æ—¶æ•°æ®å¤±è´¥:', error);
                }
            }

            // å¦‚æœæ²¡æœ‰ä¸´æ—¶æ•°æ®ï¼Œåˆ™è°ƒç”¨APIè·å–
            console.log('ğŸ“¡ ä»APIè·å–æ™¯ç‚¹è¯¦æƒ…');
            
            // æ„å»ºAPI URL
            let apiUrl = '/travel/api/attractionDetail?';
            if (attractionName) {
                apiUrl += `name=${encodeURIComponent(attractionName)}`;
            }
            if (attractionId) {
                apiUrl += attractionName ? `&id=${attractionId}` : `id=${attractionId}`;
            }

            console.log('ğŸŒ API URL:', apiUrl);

            // è°ƒç”¨APIè·å–è¯¦æƒ…
            fetch(apiUrl)
                .then(response => {
                    console.log('ğŸ“¡ APIå“åº”çŠ¶æ€:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ“Š APIè¿”å›æ•°æ®:', data);
                    if (data.success && data.attraction) {
                        currentAttraction = data.attraction;
                        displayAttractionDetail(data.attraction);
                        
                        // ä¿å­˜æµè§ˆå†å²
                        userDataManager.saveBrowsingHistory(
                            data.attraction.name || data.attraction.title,
                            data.attraction
                        );
                    } else {
                        console.error('âŒ APIè¿”å›å¤±è´¥:', data.message);
                        showError(data.message || 'æ™¯ç‚¹ä¿¡æ¯ä¸å­˜åœ¨');
                    }
                })
                .catch(error => {
                    console.error('âŒ åŠ è½½æ™¯ç‚¹è¯¦æƒ…å¤±è´¥:', error);
                    showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                });
        }

        // æ˜¾ç¤ºæ™¯ç‚¹è¯¦æƒ…
        function displayAttractionDetail(attraction) {
            console.log('ğŸ–¼ï¸ å¼€å§‹æ˜¾ç¤ºæ™¯ç‚¹è¯¦æƒ…ï¼ŒåŸå§‹æ•°æ®:', attraction);
            
            const name = attraction.name || attraction.title || 'æœªçŸ¥æ™¯ç‚¹';
            const description = attraction.description || attraction.content || 'æš‚æ— è¯¦ç»†ä»‹ç»';
            const province = attraction.province || '';
            const city = attraction.city || '';
            const rating = attraction.rating || '4.5';
            const priceRange = attraction.priceRange || attraction.price_range || 'å…è´¹';
            const features = attraction.features || '';
            const tips = attraction.tips || '';
            const openingHours = attraction.opening_hours || attraction.openingHours || 'å…¨å¤©å¼€æ”¾';
            const viewCount = attraction.view_count || Math.floor(Math.random() * 5000) + 1000;
            const likeCount = attraction.like_count || Math.floor(Math.random() * 500) + 100;
            const imageUrl = attraction.image_url || attraction.imageUrl || getRandomDefaultImage();
            
            console.log('ğŸ“Š å¤„ç†åçš„æ•°æ®:', {
                name, description, province, city, rating, priceRange, 
                features, tips, openingHours, viewCount, likeCount, imageUrl
            });

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${name} - æ™¯ç‚¹è¯¦æƒ… - æ¸¸å¸‚ç”Ÿæ´»`;

            // å¡«å……åŸºæœ¬ä¿¡æ¯
            document.getElementById('attraction-name').textContent = name;
            document.getElementById('attraction-location').textContent = `${province} ${city}`;
            document.getElementById('attraction-description').textContent = description;
            document.getElementById('attraction-rating').textContent = rating;
            document.getElementById('view-count').textContent = viewCount.toLocaleString();
            document.getElementById('like-count').textContent = likeCount.toLocaleString();
            
            // è®¾ç½®å›¾ç‰‡å¹¶æ·»åŠ æ—¥å¿—
            const mainImage = document.getElementById('main-image');
            console.log('ğŸ–¼ï¸ è®¾ç½®å›¾ç‰‡URL:', imageUrl);
            
            // æ·»åŠ å›¾ç‰‡åŠ è½½äº‹ä»¶ç›‘å¬å™¨
            mainImage.onload = function() {
                console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:', this.src);
            };
            
            mainImage.src = imageUrl;
            mainImage.alt = `${name} - æ™¯ç‚¹å›¾ç‰‡`;
            
            document.getElementById('price-range').textContent = priceRange;
            document.getElementById('opening-hours').textContent = openingHours;
            document.getElementById('rating-text').textContent = rating;

            // æ›´æ–°æ”¶è—æŒ‰é’®çŠ¶æ€
            updateFavoriteButton(name);

            // ç”Ÿæˆè¯„åˆ†æ˜Ÿæ˜Ÿ
            generateRatingStars(parseFloat(rating));

            // ç”Ÿæˆç‰¹è‰²æ ‡ç­¾
            generateFeatures(features);

            // æ˜¾ç¤ºå°è´´å£«
            if (tips) {
                document.getElementById('tips-section').style.display = 'block';
                document.getElementById('tips-content').textContent = tips;
            }

            // ç”Ÿæˆçƒ­åº¦æ˜¾ç¤º
            const popularity = viewCount > 3000 ? 'è¶…äººæ°”æ™¯ç‚¹' : viewCount > 1500 ? 'çƒ­é—¨æ™¯ç‚¹' : 'æ¨èæ™¯ç‚¹';
            document.getElementById('popularity').textContent = popularity;

            // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºå†…å®¹
            hideLoading();
            document.getElementById('attraction-detail').style.display = 'block';

            console.log('âœ… æ™¯ç‚¹è¯¦æƒ…åŠ è½½å®Œæˆ:', name);
        }

        // ç”Ÿæˆè¯„åˆ†æ˜Ÿæ˜Ÿ
        function generateRatingStars(rating) {
            const starsContainer = document.getElementById('rating-stars');
            starsContainer.innerHTML = '';
            
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('i');
                if (i < fullStars) {
                    star.className = 'fas fa-star star';
                } else if (i === fullStars && hasHalfStar) {
                    star.className = 'fas fa-star-half-alt star';
                } else {
                    star.className = 'far fa-star star';
                    star.style.color = '#ddd';
                }
                starsContainer.appendChild(star);
            }
        }

        // ç”Ÿæˆç‰¹è‰²æ ‡ç­¾
        function generateFeatures(features) {
            const container = document.getElementById('features-container');
            container.innerHTML = '';
            
            let featureList = [];
            if (features) {
                featureList = features.split(',').map(f => f.trim()).filter(f => f);
            }
            
            // å¦‚æœæ²¡æœ‰ç‰¹è‰²ï¼Œæ·»åŠ é»˜è®¤æ ‡ç­¾
            if (featureList.length === 0) {
                featureList = ['é£æ™¯ä¼˜ç¾', 'å€¼å¾—æ¨è', 'å†å²æ‚ ä¹…', 'æ–‡åŒ–æ·±åš'];
            }
            
            featureList.forEach(feature => {
                const tag = document.createElement('div');
                tag.className = 'feature-tag';
                tag.textContent = feature;
                container.appendChild(tag);
            });
        }

        // æ›´æ–°æ”¶è—æŒ‰é’®çŠ¶æ€
        function updateFavoriteButton(attractionName) {
            const favoriteBtn = document.getElementById('favorite-btn');
            const icon = favoriteBtn.querySelector('i');
            
            if (userDataManager.isFavorite(attractionName)) {
                icon.className = 'fas fa-heart';
                favoriteBtn.classList.add('favorited');
                favoriteBtn.title = 'å–æ¶ˆæ”¶è—';
            } else {
                icon.className = 'far fa-heart';
                favoriteBtn.classList.remove('favorited');
                favoriteBtn.title = 'æ·»åŠ æ”¶è—';
            }
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        function toggleFavorite() {
            if (!currentAttraction) return;
            
            const name = currentAttraction.name || currentAttraction.title;
            const isFavorited = userDataManager.toggleFavorite(name, currentAttraction);
            
            updateFavoriteButton(name);
            
            // æ˜¾ç¤ºæç¤º
            const message = isFavorited ? 'å·²æ·»åŠ åˆ°æ”¶è—' : 'å·²å–æ¶ˆæ”¶è—';
            showToast(message);
        }

        // æ·»åŠ åˆ°æ”¶è—ï¼ˆå¿«é€Ÿæ“ä½œæŒ‰é’®ï¼‰
        function addToFavorites() {
            toggleFavorite();
        }

        // åˆ†äº«æ™¯ç‚¹
        function shareAttraction() {
            if (!currentAttraction) return;
            
            const name = currentAttraction.name || currentAttraction.title;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: `${name} - æ¸¸å¸‚ç”Ÿæ´»`,
                    text: `æ¨èä¸€ä¸ªå¥½åœ°æ–¹ï¼š${name}`,
                    url: url
                }).catch(err => console.log('åˆ†äº«å¤±è´¥:', err));
            } else {
                // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(url).then(() => {
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(() => {
                    showToast('åˆ†äº«åŠŸèƒ½æš‚ä¸å¯ç”¨');
                });
            }
        }

        // åé¦ˆé—®é¢˜
        function reportIssue() {
            const name = currentAttraction ? (currentAttraction.name || currentAttraction.title) : 'æœªçŸ¥æ™¯ç‚¹';
            showToast('æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šåŠæ—¶å¤„ç†');
            console.log('ç”¨æˆ·åé¦ˆé—®é¢˜:', name);
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 206, 209, 0.9);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-weight: 600;
                z-index: 9999;
                backdrop-filter: blur(10px);
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 2000);
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('attraction-detail').style.display = 'none';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('attraction-detail').style.display = 'none';
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'block';
            errorDiv.querySelector('div').textContent = message;
            
            // å³ä½¿å‡ºé”™ä¹Ÿç¡®ä¿æœ‰å›¾ç‰‡æ˜¾ç¤º
            const mainImage = document.getElementById('main-image');
            if (mainImage && !mainImage.src.includes('unsplash')) {
                mainImage.src = getRandomDefaultImage();
                console.log('âŒ å‡ºé”™æ—¶è®¾ç½®é»˜è®¤å›¾ç‰‡');
            }
        }

        // å¼ºåˆ¶ç¡®ä¿å›¾ç‰‡æ˜¾ç¤ºï¼ˆå¤‡ç”¨æœºåˆ¶ï¼‰
        function ensureImageDisplay() {
            const mainImage = document.getElementById('main-image');
            if (mainImage && (!mainImage.src || mainImage.src === '' || mainImage.src === window.location.href)) {
                console.log('ğŸ”§ å¼ºåˆ¶è®¾ç½®é»˜è®¤å›¾ç‰‡');
                mainImage.src = getRandomDefaultImage();
            }
        }

        // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡å›¾ç‰‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
        setInterval(ensureImageDisplay, 3000);

        console.log('ğŸš€ æ™¯ç‚¹è¯¦æƒ…é¡µé¢å·²åˆå§‹åŒ–');
        console.log('ğŸ² å¯ç”¨é»˜è®¤å›¾ç‰‡æ•°é‡:', defaultAttractionImages.length);
    </script>
</body>
</html> 